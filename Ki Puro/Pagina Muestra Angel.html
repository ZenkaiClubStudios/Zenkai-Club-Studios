<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‚öú ùíÅùíÜùíèùíåùíÇùíä ùë™ùíçùíñùíÉ ùë∫ùíïùíñùíÖùíäùíêùíî ‚öú</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap');

  :root{ --bg1:#0a0f23; --bg2:#030512; --neon-mag:#ff00ff; --neon-cyan:#00ffff; --soft:#b8dfff; }
  *{ box-sizing:border-box; }
  
  html, body{ margin:0; padding:0; width:100%; height:100%; overflow-x:hidden; }
  
  body{
    min-height:100vh;
    font-family:'Orbitron',sans-serif;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    color:#fff;
    padding:10px 20px 40px 20px;
    position:relative;
    overflow-x:hidden;
    overflow-y:auto;
  }

  body::before{
    content:'';
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:linear-gradient(180deg, #1a0033 0%, #2d0052 30%, #1a0033 60%, #0d001a 100%);
    z-index:-3;
  }

  body::after{
    content:'';
    position:fixed;
    top:10%; right:8%;
    width:350px; height:350px;
    background:radial-gradient(circle at 30% 30%, #ff66ff 0%, #dd00ff 25%, #8800cc 50%, #440066 75%, transparent 100%);
    border-radius:50%;
    filter:blur(25px) drop-shadow(0 0 60px rgba(255,0,255,0.6));
    opacity:0.8;
    z-index:-2;
    animation:moonFloat 6s ease-in-out infinite;
    box-shadow:inset -30px -30px 80px rgba(0,0,0,0.4), 0 0 80px rgba(255,0,255,0.4);
  }

  @keyframes moonFloat{ 0%,100%{ transform:translateY(0) translateX(0); } 50%{ transform:translateY(-15px) translateX(8px); } }

  .grid-container{ 
    position:fixed; 
    top:0; left:0; 
    width:100%; height:100%; 
    z-index:-1; 
    perspective:800px; 
    overflow:hidden; 
  }
  
  .grid-lines{
    position:absolute;
    width:100%; 
    height:100%;
    background-image: 
      linear-gradient(0deg, rgba(0,255,255,0.12) 1px, transparent 1px), 
      linear-gradient(90deg, rgba(0,255,255,0.12) 1px, transparent 1px);
    background-size:80px 80px;
    background-position:0 0;
    animation:gridFly 4s linear infinite;
    transform-origin:center center;
  }

  @keyframes gridFly{
    0%{
      transform:perspective(600px) rotateX(70deg) translateY(-100%);
      opacity:0;
    }
    15%{
      opacity:0.3;
    }
    50%{
      transform:perspective(600px) rotateX(70deg) translateY(0);
      opacity:0.6;
    }
    85%{
      opacity:0.3;
    }
    100%{
      transform:perspective(600px) rotateX(70deg) translateY(100%);
      opacity:0;
    }
  }

  .rain{ position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none; overflow:hidden; }
  .raindrop{ position:absolute; width:3px; height:3px; background:radial-gradient(circle at 30% 30%, #ffffff, #00ffff); border-radius:50%; animation:shootingStar linear infinite; box-shadow:0 0 6px rgba(255,255,255,0.8), 0 0 12px rgba(0,255,255,0.6); }
  @keyframes shootingStar{ 
    0%{ transform:translateY(-10px) translateX(0) scaleX(1); opacity:1; }
    50%{ opacity:0.8; }
    100%{ transform:translateY(100vh) translateX(30px) scaleX(0.3); opacity:0; }
  }

  .container{
    width:1100px;
    max-width:98vw;
    height:auto;
    min-height:600px;
    background:rgba(8,14,28,0.64);
    border-radius:16px;
    box-shadow:0 10px 60px rgba(0,200,255,0.06);
    display:flex;
    gap:30px;
    padding:35px;
    margin:20px auto;
    position:relative;
    align-items:flex-start;
    backdrop-filter:blur(6px);
    z-index:10;
  }

  .left-panel{ width:35%; display:flex; flex-direction:column; align-items:center; gap:12px; padding-top:10px; flex-shrink:0; }
  .logo{ width:140px; height:140px; object-fit:contain; filter:drop-shadow(0 0 18px rgba(0,255,255,0.18)); animation:spin 10s linear infinite; }
  @keyframes spin{ from{ transform:rotate(0); } to{ transform:rotate(360deg); } }

  .name{ font-size:32px; margin-top:8px; background:linear-gradient(90deg,var(--neon-mag), var(--neon-cyan)); -webkit-background-clip:text; color:transparent; -webkit-text-fill-color:transparent; text-align:center; }
  .average{ margin-top:10px; font-size:64px; font-weight:800; text-shadow:0 0 20px rgba(255,0,255,0.45), 0 0 38px rgba(0,255,255,0.28); animation:avgPulse 2200ms infinite alternate; }
  @keyframes avgPulse{ 0%{ transform:translateY(0); filter:drop-shadow(0 0 18px rgba(255,0,255,0.25)); } 100%{ transform:translateY(-4px); filter:drop-shadow(0 0 38px rgba(0,255,255,0.4)); } }

  .stats{ width:100%; margin-top:16px; color:var(--soft); background:rgba(0,0,0,0.5); padding:20px; border-radius:12px; border:1px solid rgba(0,255,255,0.2); min-height:220px; }
  .stats table{ width:100%; border-collapse:collapse; }
  .stats tr{ border-bottom:1px solid rgba(0,255,255,0.08); }
  .stats tr:last-child{ border-bottom:none; }
  .stats td{ padding:12px 8px; font-size:15px; vertical-align:middle; color:#b8dfff; }
  .stat-name{ color:#ff80ff; font-weight:600; width:50%; text-shadow:0 0 4px rgba(255,0,255,0.12); }
  .stat-value{ text-align:right; width:20%; font-size:17px; font-weight:700; color:#00ffff; }
  .stat-rank{ text-align:right; width:30%; padding-left:8px; }

  .ki-display{ width:100%; margin-top:12px; padding:12px 14px; background:rgba(0,0,0,0.3); border:1px solid rgba(0,255,255,0.1); border-radius:8px; text-align:center; font-size:13px; color:rgba(180,180,180,0.8); font-weight:600; letter-spacing:0.5px; }
  .ki-display.active{ color:#ffff00; border-color:rgba(255,255,0,0.3); background:rgba(50,50,0,0.2); text-shadow:0 0 10px rgba(255,255,0,0.5); animation:kiGlow 1.5s ease-in-out infinite; }
  .ki-display.devoured{ color:#666; border-color:rgba(100,100,100,0.3); background:rgba(20,20,20,0.4); text-decoration:line-through; opacity:0.5; }
  @keyframes kiGlow{ 0%,100%{ text-shadow:0 0 10px rgba(255,255,0,0.5); } 50%{ text-shadow:0 0 20px rgba(255,255,0,0.8); } }

  .badge{ display:inline-block; padding:8px 14px; border-radius:8px; font-weight:800; font-size:13px; min-width:48px; text-align:center; }
  .badge-F{ background:rgba(255,255,255,0.03); color:#d7d7d7; }
  .badge-E{ background:rgba(12,160,160,0.04); color:#cfefff; }
  .badge-D{ background:rgba(0,200,120,0.03); color:#bfffbf; }
  .badge-C{ background:linear-gradient(90deg,#bfffd6, #9fffbf); color:#013; }
  .badge-B{ background:linear-gradient(90deg,#fff0d6,#ffd28a); color:#4a2b0d; }
  .badge-A{ background:linear-gradient(90deg,#ff90ff22,#90f0ff22); color:#ffdfff; }
  .badge-S{ background:linear-gradient(90deg,#00d4ff22,#6a15ff22); color:#bff8ff; }
  .badge-SS{ background:linear-gradient(90deg,#8afcff33,#ff7bff33); color:#fff0ff; }
  .badge-Z{ background:linear-gradient(90deg,#ff00ff33,#00ffff33); color:#fff; }

  .right-panel{ width:65%; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:20px; }
  .rank-card-top{ display:flex; flex-direction:column; align-items:center; gap:8px; text-align:center; z-index:9; }
  .rank-letter{ font-size:72px; font-weight:900; line-height:0.85; -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
  .rank-sub{ font-size:14px; color:rgba(200,220,255,0.95); letter-spacing:0.6px; }

  .rank-F .rank-letter{ color:#dcdcdc; -webkit-text-fill-color:#dcdcdc; }
  .rank-E .rank-letter{ color:#cfefff; -webkit-text-fill-color:#cfefff; text-shadow:0 0 6px rgba(0,255,255,0.08); }
  .rank-D .rank-letter{ color:#bfffbf; -webkit-text-fill-color:#bfffbf; text-shadow:0 0 8px rgba(0,255,0,0.08); }
  .rank-C .rank-letter{ color:#9fffbf; -webkit-text-fill-color:#9fffbf; text-shadow:0 0 10px rgba(0,255,200,0.12); animation:smallPulse 2.6s infinite ease-in-out; }
  .rank-B .rank-letter{ background:linear-gradient(90deg,#ffd28a,#fff0d6); -webkit-background-clip:text; -webkit-text-fill-color:transparent; text-shadow:0 0 12px rgba(255,160,50,0.14); animation:smallPulse 2.4s infinite; }
  .rank-A .rank-letter{ background:linear-gradient(90deg,#ff90ff,#90f0ff); -webkit-background-clip:text; text-shadow:0 0 18px rgba(144,0,255,0.18); animation:medPulse 2s infinite; }
  .rank-S .rank-letter{ background:linear-gradient(90deg,#00d4ff,#6a15ff); -webkit-background-clip:text; text-shadow:0 0 24px rgba(0,212,255,0.22); animation:medPulse 1.8s infinite; }
  .rank-SS .rank-letter{ background:linear-gradient(90deg,#8afcff,#ff7bff); -webkit-background-clip:text; text-shadow:0 0 36px rgba(255,123,255,0.28); animation:strongPulse 1.6s infinite; }
  .rank-Z .rank-letter{ background:linear-gradient(90deg,#ff00ff,#ffb000,#00ffff); background-size:300% 300%; -webkit-background-clip:text; text-shadow:0 0 40px rgba(255,0,255,0.45), 0 0 80px rgba(0,255,255,0.28); animation:dimPulse 1.2s infinite; }

  @keyframes smallPulse{ 0%{ transform:scale(1); } 50%{ transform:scale(1.02); } 100%{ transform:scale(1); } }
  @keyframes medPulse{ 0%{ transform:scale(1); } 50%{ transform:scale(1.045); } 100%{ transform:scale(1); } }
  @keyframes strongPulse{ 0%{ transform:scale(1); } 50%{ transform:scale(1.08); } 100%{ transform:scale(1); } }
  @keyframes dimPulse{ 0%{ background-position:0% 50%; } 100%{ background-position:100% 50%; } }

  .radar-wrapper{ width:380px; height:380px; position:relative; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
  canvas{ max-width:380px; max-height:380px; }
  .z-ring{ position:absolute; width:400px; height:400px; border-radius:50%; top:50%; left:50%; transform:translate(-50%,-50%); z-index:5; pointer-events:none; filter:blur(10px); }

  .rank-description{ margin-top:16px; padding:14px 16px; background:rgba(0,0,0,0.4); border:1px solid rgba(0,255,255,0.2); border-radius:10px; font-size:13px; line-height:1.5; color:rgba(180,220,255,0.9); text-align:center; max-width:380px; box-shadow:0 4px 15px rgba(0,0,0,0.3); }
  .rank-description strong{ color:rgba(255,200,255,0.95); display:block; margin-bottom:6px; font-size:14px; }

  .cognitive-profile{ margin-top:12px; padding:14px 16px; background:rgba(0,0,0,0.4); border:1px solid rgba(0,255,255,0.2); border-radius:10px; font-size:12px; line-height:1.6; color:rgba(180,220,255,0.9); text-align:center; max-width:380px; margin-bottom:20px; box-shadow:0 4px 15px rgba(0,0,0,0.3); display:none; }
  .cognitive-profile strong{ color:rgba(255,200,255,0.95); display:block; margin-bottom:6px; font-size:13px; }
  .cognitive-profile.show{ display:block; animation:slideIn 0.5s ease-out; }
  .cognitive-profile.high-intelligence{ background:rgba(144,0,255,0.08); border:1px solid rgba(144,0,255,0.3); box-shadow:0 4px 15px rgba(144,0,255,0.15); }
  .cognitive-profile.high-intelligence strong{ color:rgba(255,100,255,0.95); text-shadow:0 0 10px rgba(255,100,255,0.5); }
  .cognitive-profile.high-intelligence{ animation:slideIn 0.5s ease-out, cogGlow 1.5s ease-in-out infinite; }
  @keyframes slideIn{ from{ opacity:0; transform:translateY(-8px); } to{ opacity:1; transform:translateY(0); } }
  @keyframes cogGlow{ 0%,100%{ box-shadow:0 4px 15px rgba(144,0,255,0.15); } 50%{ box-shadow:0 4px 25px rgba(144,0,255,0.35); } }

  .magic-warning{ display:block; margin-top:10px; padding:10px 14px; background:rgba(255,0,0,0.15); border:2px solid rgba(255,50,50,0.5); border-radius:8px; color:rgba(255,120,120,0.98); font-size:12px; line-height:1.5; box-shadow:0 0 15px rgba(255,0,0,0.2); animation:magicPulse 1.5s ease-in-out infinite; }
  .magic-warning strong{ color:rgba(255,80,80,1); font-size:13px; display:block; margin-bottom:6px; text-shadow:0 0 8px rgba(255,0,0,0.5); }
  .magic-warning.moderate{ background:rgba(255,140,0,0.15); border-color:rgba(255,140,0,0.5); color:rgba(255,180,120,0.98); box-shadow:0 0 15px rgba(255,140,0,0.2); }
  .magic-warning.moderate strong{ color:rgba(255,140,0,1); text-shadow:0 0 8px rgba(255,140,0,0.5); }
  .magic-warning.high{ background:rgba(255,200,0,0.12); border-color:rgba(255,200,0,0.4); color:rgba(255,220,150,0.98); box-shadow:0 0 12px rgba(255,200,0,0.15); animation:none; }
  .magic-warning.high strong{ color:rgba(255,200,0,1); text-shadow:0 0 6px rgba(255,200,0,0.4); }
  @keyframes magicPulse{ 0%,100%{ box-shadow:0 0 15px rgba(255,0,0,0.2); } 50%{ box-shadow:0 0 25px rgba(255,0,0,0.4); } }

  .magic-display{ margin-top:16px; padding:14px 16px; background:rgba(138,43,226,0.15); border:2px solid rgba(138,43,226,0.5); border-radius:10px; font-size:13px; line-height:1.6; color:rgba(200,150,255,0.95); text-align:center; max-width:380px; box-shadow:0 4px 20px rgba(138,43,226,0.2); display:none; margin-bottom:20px; }
  .magic-display strong{ color:rgba(186,85,211,1); display:block; margin-bottom:10px; font-size:14px; text-shadow:0 0 10px rgba(138,43,226,0.4); }
  .magic-display.show{ display:block; animation:slideIn 0.5s ease-out; }
  .magic-display.destructive{ background:rgba(139,0,139,0.2); border:2px solid rgba(186,85,211,0.7); box-shadow:0 4px 25px rgba(139,0,139,0.3); animation:slideIn 0.5s ease-out, magicGlow 1.5s ease-in-out infinite; }
  @keyframes magicGlow{ 0%,100%{ box-shadow:0 4px 25px rgba(139,0,139,0.3); } 50%{ box-shadow:0 4px 35px rgba(186,85,211,0.5); } }
  .magic-type{ font-weight:700; color:rgba(200,150,255,0.99); margin-bottom:8px; font-size:14px; }
  .magic-control-bar-container{ width:100%; height:20px; background:rgba(0,0,0,0.4); border:1px solid rgba(138,43,226,0.3); border-radius:8px; overflow:hidden; margin:10px 0; }
  .magic-control-bar{ height:100%; background:linear-gradient(90deg, rgba(138,43,226,0.8), rgba(186,85,211,0.9)); width:0%; transition:width 0.5s ease-out; box-shadow:inset 0 0 10px rgba(138,43,226,0.3), 0 0 10px rgba(186,85,211,0.4); }
  .magic-control-level{ font-weight:700; font-size:12px; color:rgba(200,150,255,0.95); margin-bottom:8px; }
  .magic-ki-usage{ font-size:12px; line-height:1.5; color:rgba(200,170,255,0.9); margin-top:8px; padding-top:8px; border-top:1px solid rgba(138,43,226,0.2); }
  .magic-description{ font-size:12px; line-height:1.5; color:rgba(180,150,255,0.9); margin-top:8px; }

  .spirit-display{ margin-top:16px; padding:14px 16px; background:rgba(0,200,255,0.12); border:2px solid rgba(0,200,255,0.4); border-radius:10px; font-size:13px; line-height:1.6; color:rgba(180,240,255,0.95); text-align:center; max-width:380px; box-shadow:0 4px 20px rgba(0,200,255,0.15); display:none; margin-bottom:20px; }
  .spirit-display strong{ color:rgba(100,220,255,1); display:block; margin-bottom:10px; font-size:14px; text-shadow:0 0 10px rgba(0,200,255,0.4); }
  .spirit-display.show{ display:block; animation:slideIn 0.5s ease-out; }
  .spirit-display.anexion{ background:rgba(138,43,226,0.12); border:2px solid rgba(138,43,226,0.5); box-shadow:0 4px 25px rgba(138,43,226,0.2); animation:slideIn 0.5s ease-out, spiritGlowPurple 1.8s ease-in-out infinite; }
  .spirit-display.anexion strong{ color:rgba(186,85,211,1); text-shadow:0 0 10px rgba(138,43,226,0.5); }
  .spirit-display.entidad{ background:rgba(20,20,20,0.85); border:2px solid rgba(0,255,100,0.6); box-shadow:0 4px 30px rgba(0,255,100,0.25), inset 0 0 20px rgba(0,0,0,0.6); animation:slideIn 0.5s ease-out, entityPulse 2s ease-in-out infinite; }
  .spirit-display.entidad strong{ color:rgba(100,255,150,1); text-shadow:0 0 15px rgba(0,255,100,0.6); }
  @keyframes spiritGlowPurple{ 0%,100%{ box-shadow:0 4px 25px rgba(138,43,226,0.2); } 50%{ box-shadow:0 4px 35px rgba(138,43,226,0.4); } }
  @keyframes entityPulse{ 0%,100%{ box-shadow:0 4px 30px rgba(0,255,100,0.25), inset 0 0 20px rgba(0,0,0,0.6); } 50%{ box-shadow:0 4px 45px rgba(0,255,100,0.45), inset 0 0 30px rgba(0,0,0,0.8); } }

  .spirit-type{ font-weight:700; color:rgba(180,240,255,0.99); margin-bottom:8px; font-size:14px; }
  .spirit-display.anexion .spirit-type{ color:rgba(200,150,255,0.99); }
  .spirit-display.entidad .spirit-type{ color:rgba(150,255,180,0.99); }

  .spirit-target-info{ margin:10px 0; padding:10px; background:rgba(0,0,0,0.3); border:1px solid rgba(0,200,255,0.2); border-radius:8px; font-size:12px; }
  .spirit-display.anexion .spirit-target-info{ border-color:rgba(138,43,226,0.3); }
  .spirit-display.entidad .spirit-target-info{ border-color:rgba(0,255,100,0.3); background:rgba(0,0,0,0.5); }

  .spirit-warning{ display:block; margin-top:10px; padding:8px 12px; background:rgba(255,100,100,0.12); border:1px solid rgba(255,100,100,0.3); border-radius:6px; color:rgba(255,150,150,0.95); font-size:11px; line-height:1.4; }
  .spirit-warning strong{ color:rgba(255,120,120,0.99); }

  .spirit-no-target{ color:rgba(255,200,100,0.95); font-style:italic; padding:8px; background:rgba(255,140,0,0.1); border-radius:6px; margin:8px 0; }

  .entity-abilities{ margin-top:12px; padding:10px; background:rgba(0,0,0,0.4); border:1px solid rgba(0,255,100,0.25); border-radius:8px; }
  .entity-ability-item{ margin:6px 0; font-size:12px; color:rgba(200,255,220,0.9); }
  .entity-ability-item strong{ color:rgba(150,255,180,1); }

  .entity-control-bar-container{ width:100%; height:18px; background:rgba(0,0,0,0.5); border:1px solid rgba(0,255,100,0.3); border-radius:8px; overflow:hidden; margin:8px 0; }
  .entity-control-bar{ height:100%; background:linear-gradient(90deg, rgba(0,200,100,0.7), rgba(0,255,100,0.9)); width:0%; transition:width 0.5s ease-out; box-shadow:inset 0 0 10px rgba(0,255,100,0.2), 0 0 10px rgba(0,255,100,0.3); }

  .pure-display{ margin-top:16px; padding:14px 16px; background:rgba(255,255,255,0.08); border:2px solid rgba(255,255,255,0.4); border-radius:10px; font-size:13px; line-height:1.6; color:rgba(255,255,255,0.95); text-align:center; max-width:380px; box-shadow:0 0 20px rgba(255,255,255,0.15), inset 0 0 15px rgba(255,255,255,0.05); display:none; margin-bottom:20px; }
  .pure-display strong{ color:rgba(255,255,255,1); display:block; margin-bottom:10px; font-size:14px; text-shadow:0 0 12px rgba(255,255,255,0.6); }
  .pure-display.show{ display:block; animation:slideIn 0.5s ease-out; }
  .pure-display.normal{ background:rgba(255,250,200,0.12); border:2px solid rgba(255,220,150,0.5); box-shadow:0 0 25px rgba(255,220,150,0.2), inset 0 0 15px rgba(255,250,200,0.08); animation:slideIn 0.5s ease-out, pureGlowWarm 2s ease-in-out infinite; }
  .pure-display.normal strong{ color:rgba(255,240,180,1); text-shadow:0 0 15px rgba(255,220,150,0.7); }
  .pure-display.purgatorio{ background:rgba(200,230,255,0.12); border:2px solid rgba(150,200,255,0.5); box-shadow:0 0 25px rgba(150,200,255,0.25), inset 0 0 15px rgba(200,230,255,0.08); animation:slideIn 0.5s ease-out, pureGlowBlue 2s ease-in-out infinite; }
  .pure-display.purgatorio strong{ color:rgba(180,220,255,1); text-shadow:0 0 15px rgba(150,200,255,0.7); }
  .pure-display.maligno{ background:rgba(139,0,0,0.25); border:2px solid rgba(255,50,50,0.6); box-shadow:0 0 30px rgba(255,0,0,0.3), 0 0 50px rgba(255,255,255,0.2), inset 0 0 20px rgba(0,0,0,0.6); animation:slideIn 0.5s ease-out, evilPureGlow 1.5s ease-in-out infinite; }
  .pure-display.maligno strong{ color:rgba(255,100,100,1); text-shadow:0 0 20px rgba(255,0,0,0.8), 0 0 30px rgba(255,255,255,0.6); }
  @keyframes pureGlowWarm{ 0%,100%{ box-shadow:0 0 25px rgba(255,220,150,0.2), inset 0 0 15px rgba(255,250,200,0.08); } 50%{ box-shadow:0 0 40px rgba(255,220,150,0.4), inset 0 0 25px rgba(255,250,200,0.15); } }
  @keyframes pureGlowBlue{ 0%,100%{ box-shadow:0 0 25px rgba(150,200,255,0.25), inset 0 0 15px rgba(200,230,255,0.08); } 50%{ box-shadow:0 0 40px rgba(150,200,255,0.45), inset 0 0 25px rgba(200,230,255,0.15); } }
  @keyframes evilPureGlow{ 0%,100%{ box-shadow:0 0 30px rgba(255,0,0,0.3), 0 0 50px rgba(255,255,255,0.2), inset 0 0 20px rgba(0,0,0,0.6); } 50%{ box-shadow:0 0 45px rgba(255,0,0,0.5), 0 0 70px rgba(255,255,255,0.4), inset 0 0 30px rgba(0,0,0,0.8); } }

  .pure-type{ font-weight:700; margin-bottom:8px; font-size:14px; }
  .pure-display.normal .pure-type{ color:rgba(255,240,180,0.99); }
  .pure-display.purgatorio .pure-type{ color:rgba(180,220,255,0.99); }
  .pure-display.maligno .pure-type{ color:rgba(255,120,120,0.99); }

  .pure-rank-info{ margin:10px 0; padding:10px; background:rgba(0,0,0,0.25); border:1px solid rgba(255,255,255,0.15); border-radius:8px; font-size:12px; }
  .pure-display.normal .pure-rank-info{ border-color:rgba(255,220,150,0.25); background:rgba(255,250,200,0.08); }
  .pure-display.purgatorio .pure-rank-info{ border-color:rgba(150,200,255,0.25); background:rgba(200,230,255,0.08); }
  .pure-display.maligno .pure-rank-info{ border-color:rgba(255,50,50,0.35); background:rgba(139,0,0,0.15); }

  .pure-purity-bar-container{ width:100%; height:18px; background:rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.2); border-radius:8px; overflow:hidden; margin:8px 0; }
  .pure-purity-bar{ height:100%; background:linear-gradient(90deg, rgba(255,220,150,0.7), rgba(255,255,255,0.9)); width:0%; transition:width 0.5s ease-out; box-shadow:inset 0 0 10px rgba(255,255,255,0.3), 0 0 15px rgba(255,220,150,0.4); }

  .pure-corruption-bar-container{ width:100%; height:18px; background:rgba(0,0,0,0.5); border:1px solid rgba(255,50,50,0.4); border-radius:8px; overflow:hidden; margin:8px 0; }
  .pure-corruption-bar{ height:100%; background:linear-gradient(90deg, rgba(139,0,0,0.8), rgba(255,0,0,0.9), rgba(255,255,255,0.7)); width:0%; transition:width 0.5s ease-out; box-shadow:inset 0 0 10px rgba(255,0,0,0.4), 0 0 15px rgba(255,255,255,0.3); animation:corruptionPulse 1.5s ease-in-out infinite; }
  @keyframes corruptionPulse{ 0%,100%{ opacity:1; } 50%{ opacity:0.7; } }

  .pure-warning{ display:block; margin-top:10px; padding:8px 12px; background:rgba(255,220,150,0.1); border:1px solid rgba(255,220,150,0.3); border-radius:6px; color:rgba(255,240,200,0.95); font-size:11px; line-height:1.4; }
  .pure-warning strong{ color:rgba(255,230,180,0.99); }
  .pure-warning.requirement{ background:rgba(255,200,100,0.15); border-color:rgba(255,200,100,0.4); }
  .pure-warning.corrupted{ background:rgba(139,0,0,0.2); border-color:rgba(255,50,50,0.5); color:rgba(255,150,150,0.95); }
  .pure-warning.corrupted strong{ color:rgba(255,100,100,1); }

  .stat-value.unknown{ color:rgba(150,150,150,0.6); font-style:italic; letter-spacing:1px; }

  .demon-warning{ display:block; margin-top:10px; padding:8px 12px; background:rgba(139,0,0,0.15); border:1px solid rgba(220,20,60,0.3); border-radius:6px; color:rgba(255,120,120,0.95); font-size:11px; line-height:1.4; }
  .demon-warning strong{ color:rgba(255,80,80,0.99); }

  .purg-warning{ display:block; margin-top:10px; padding:8px 12px; background:rgba(30,60,120,0.2); border:1px solid rgba(80,140,255,0.4); border-radius:6px; color:#b8dfff; font-size:11px; line-height:1.4; }
  .purg-warning strong{ color:#a7d1ff; }

  .demon-ki-display{ margin-top:16px; padding:14px 16px; background:rgba(139,0,0,0.2); border:2px solid rgba(220,20,60,0.5); border-radius:10px; font-size:13px; line-height:1.6; color:rgba(255,150,150,0.95); text-align:center; max-width:380px; box-shadow:0 4px 15px rgba(220,20,60,0.2); display:none; margin-bottom:20px; }
  .demon-ki-display strong{ color:rgba(255,80,80,0.99); display:block; margin-bottom:10px; font-size:14px; text-shadow:0 0 8px rgba(255,0,0,0.4); }
  .demon-ki-display.show{ display:block; animation:slideIn 0.5s ease-out; }
  .demon-ki-display.royalty{ background:rgba(139,0,0,0.3); border:2px solid rgba(220,20,60,0.7); box-shadow:0 4px 20px rgba(220,20,60,0.35); animation:slideIn 0.5s ease-out, demonGlow 1.5s ease-in-out infinite; }
  .demon-ki-display.devoured{ opacity:0.4; text-decoration:line-through; }
  @keyframes demonGlow{ 0%,100%{ box-shadow:0 4px 20px rgba(220,20,60,0.35); } 50%{ box-shadow:0 4px 35px rgba(220,20,60,0.55); } }
  .demon-ki-level{ font-weight:700; color:rgba(255,100,100,0.99); margin-bottom:8px; font-size:14px; }
  .demon-ki-bar-container{ width:100%; height:20px; background:rgba(0,0,0,0.4); border:1px solid rgba(255,100,100,0.3); border-radius:8px; overflow:hidden; margin:10px 0; }
  .demon-ki-bar{ height:100%; background:linear-gradient(90deg, rgba(220,20,60,0.8), rgba(255,100,100,0.9)); width:0%; transition:width 0.5s ease-out; box-shadow:inset 0 0 10px rgba(255,0,0,0.3), 0 0 10px rgba(255,100,100,0.4); }
  .demon-ki-percentage{ font-weight:700; font-size:12px; color:rgba(255,150,150,0.95); margin-bottom:8px; }
  .demon-ki-description{ font-size:12px; line-height:1.5; color:rgba(255,180,180,0.9); margin-top:8px; }

  .purgatory-ki-display { margin-top:10px; padding:12px 14px; background: rgba(20,30,80,0.22); border:2px solid rgba(60,120,255,0.28); border-radius:10px; font-size:13px; line-height:1.4; color:#cfe7ff; text-align:center; max-width:380px; box-shadow:0 4px 18px rgba(40,80,200,0.12); display:none; }
  .purgatory-ki-display.show { display:block; animation:slideIn 0.5s ease-out; }
  .purgatory-ki-display.royalty { border-color:rgba(120,170,255,0.6); box-shadow:0 6px 26px rgba(60,110,255,0.22); background: rgba(20,30,80,0.28); }
  .purgatory-ki-display.devoured{ opacity:0.4; text-decoration:line-through; }
  .purgatory-ki-title { font-weight:700; color:#a7d1ff; display:block; margin-bottom:8px; font-size:14px; text-shadow:0 0 8px rgba(60,120,255,0.14); }
  .purgatory-ki-bar-container { width:100%; height:16px; background:rgba(0,0,30,0.36); border-radius:10px; overflow:hidden; border:1px solid rgba(60,120,255,0.12); margin:8px 0; }
  .purgatory-ki-bar { height:100%; width:0%; border-radius:10px; transition:width 0.6s ease, background 0.6s ease; box-shadow:inset 0 0 10px rgba(80,120,255,0.12), 0 0 8px rgba(60,140,255,0.06); }
  .purgatory-ki-info { font-size:12px; color:#d8e9ff; margin-top:6px; }

  .void-ki-display{ margin-top:16px; padding:16px 18px; background:rgba(0,0,0,0.7); border:3px solid rgba(255,140,0,0.6); border-radius:10px; font-size:13px; line-height:1.6; color:rgba(255,200,150,0.95); text-align:center; max-width:380px; box-shadow:0 0 30px rgba(255,140,0,0.3), inset 0 0 20px rgba(0,0,0,0.5); display:none; margin-bottom:20px; }
  .void-ki-display strong{ color:rgba(255,160,80,1); display:block; margin-bottom:10px; font-size:15px; text-shadow:0 0 15px rgba(255,100,0,0.6); }
  .void-ki-display.show{ display:block; animation:slideIn 0.5s ease-out, voidPulse 2s ease-in-out infinite; }
  @keyframes voidPulse{ 0%,100%{ box-shadow:0 0 30px rgba(255,140,0,0.3), inset 0 0 20px rgba(0,0,0,0.5); } 50%{ box-shadow:0 0 45px rgba(255,140,0,0.5), inset 0 0 30px rgba(0,0,0,0.7); } }
  .void-ki-charge{ font-weight:700; color:rgba(255,180,100,1); margin-bottom:10px; font-size:15px; }
  .void-ki-bar-container{ width:100%; height:22px; background:rgba(0,0,0,0.6); border:2px solid rgba(255,140,0,0.4); border-radius:10px; overflow:hidden; margin:12px 0; box-shadow:inset 0 0 10px rgba(0,0,0,0.8); }
  .void-ki-bar{ height:100%; background:linear-gradient(90deg, rgba(20,20,20,0.9), rgba(255,100,0,0.8), rgba(255,140,0,0.9)); width:0%; transition:width 0.3s ease-out; box-shadow:0 0 15px rgba(255,100,0,0.6); }
  .void-ki-bar.auto-regulating{ background:linear-gradient(90deg, rgba(139,0,0,0.9), rgba(255,0,0,0.8), rgba(220,20,20,0.9)); box-shadow:0 0 20px rgba(255,0,0,0.8); animation:redPulse 0.8s ease-in-out infinite; }
  @keyframes redPulse{ 0%,100%{ opacity:1; } 50%{ opacity:0.7; } }
  .void-ki-level{ font-weight:700; color:rgba(255,160,80,1); margin-top:10px; font-size:14px; }
  .void-ki-warning{ margin-top:12px; padding:10px; background:rgba(139,0,0,0.3); border:1px solid rgba(255,69,0,0.5); border-radius:6px; font-size:11px; color:rgba(255,150,100,0.95); }
  
  .void-control{ margin:15px 0; text-align:left; }
  .void-control label{ display:block; margin-bottom:8px; font-size:12px; color:rgba(255,180,100,0.9); font-weight:600; }
  .void-slider{ width:100%; height:8px; background:rgba(0,0,0,0.5); border-radius:4px; outline:none; -webkit-appearance:none; cursor:pointer; border:1px solid rgba(255,140,0,0.3); }
  .void-slider::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:18px; height:18px; background:linear-gradient(135deg, rgba(255,140,0,1), rgba(255,100,0,1)); border-radius:50%; cursor:pointer; box-shadow:0 0 8px rgba(255,100,0,0.8); }
  .void-slider::-moz-range-thumb{ width:18px; height:18px; background:linear-gradient(135deg, rgba(255,140,0,1), rgba(255,100,0,1)); border-radius:50%; cursor:pointer; box-shadow:0 0 8px rgba(255,100,0,0.8); border:none; }
  .void-slider:hover::-webkit-slider-thumb{ box-shadow:0 0 12px rgba(255,140,0,1); }
  .void-slider:hover::-moz-range-thumb{ box-shadow:0 0 12px rgba(255,140,0,1); }

  @media (max-width:1200px){
    .container{ flex-direction:column; align-items:center; gap:20px; min-height:auto; }
    .left-panel, .right-panel{ width:100%; }
    .logo{ width:120px; height:120px; }
    .average{ font-size:52px; }
    .rank-letter{ font-size:56px; }
    .radar-wrapper{ transform:scale(0.95); }
  }

  @media (max-width:600px){
    .container{ padding:20px; gap:15px; }
    .left-panel, .right-panel{ width:100%; }
    .logo{ width:100px; height:100px; }
    .name{ font-size:24px; }
    .average{ font-size:42px; }
    .rank-letter{ font-size:42px; }
    .radar-wrapper{ width:300px; height:300px; transform:scale(0.85); }
    canvas{ max-width:300px; max-height:300px; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="left-panel">
    <img class="logo" id="logoImg" src="" alt="Logo">
    <div class="name" id="nameText">SAM</div>
    <div id="average" class="average">0</div>
    <div class="stats">
      <table id="statsTable"></table>
    </div>
    <div id="kiDisplay" class="ki-display">Ki Dimensional: 2%</div>

    <div id="voidKiDisplay" class="void-ki-display"></div>
    <div id="demonKiDisplay" class="demon-ki-display"></div>
    <div id="purgatoryKiDisplay" class="purgatory-ki-display"></div>
    <div id="spiritDisplay" class="spirit-display"></div>
    <div id="pureDisplay" class="pure-display"></div>
    <div id="magicDisplay" class="magic-display"></div>

  </div>

  <div class="right-panel">
    <div id="rankCard" class="rank-card-top rank-Z">
      <div id="rankLetter" class="rank-letter">Z</div>
      <div id="rankSub" class="rank-sub">Nivel Dimensional</div>
    </div>

    <div class="radar-wrapper" id="radarWrapper">
      <canvas id="statsChart" width="380" height="380"></canvas>
    </div>

    <div id="rankDescription" class="rank-description"></div>
    <div id="cognitiveProfile" class="cognitive-profile"></div>
  </div>
</div>

<script>
const dataModel = {
  name: "Alguien",
  logoPath: "https://i.imgur.com/5Z7SpAw.png",
  kiDimensional: 0,
  kiDemonio: 0,
  kiPurgatorio: 0,
  kiVacio: {
    active: false, // Cambia a true para activar el Ki de Vac√≠o
    carga: 80,
    nivelDestruccion: 7
  },
  magia: {
  active: false, // Cambia a false para desactivar la Magia
  control: 70, // Control de Magia (0-100)
  tipo: "constante" // "constante" o "destructiva"
  },
  kiEspiritual: {
  active: false, // Cambia a true para activar Ki Espiritual
  tipo: "entidad", // "normal", "anexion", "entidad"
  
  // Sistema de copia de objetivo
  objetivo: {
    active: true, // ¬øEst√° copiando a alguien actualmente?
    nombre: "Tai Long",
    stats: [58, 59, 65, 70, 63, 64] // [Fuerza, Velocidad, Stamina, Potencial, Precisi√≥n, Durabilidad]
  },
  
  // Configuraci√≥n para Anexi√≥n
  anexion: {
    boostPercentage: 20 // Porcentaje de mejora sobre el objetivo (15-30% recomendado)
  },
  
  // Configuraci√≥n para La Entidad
  entidad: {
    cristalesActivos: true,
    controlMental: 75, // 0-100
    toleranciaKiDimensional: 25, // % que puede tolerar sin morir
    corrupcionMental: 30 // % de corrupci√≥n que AUMENTA la inteligencia
  }
  },
  kiPuro: {
  active: true, // Cambia a true para activar Ki Puro
  tipo: "normal", // "normal", "purgatorio", "maligno"
  rango: "angel", // "angel" o "arcangel" (solo para normal y purgatorio)
  pureza: 85, // 0-100 (solo para normal, indica qu√© tan puro es el coraz√≥n)
  corrupcion: 0 // 0-100 (solo para maligno, nivel de corrupci√≥n)
  },
  stats: [["Fuerza", 58], ["Velocidad", 59], ["Stamina", 65], ["Potencial", 70], ["Precisi√≥n", 63], ["Durabilidad", 64], ["Inteligencia", 43]]
};

let chartInstance = null;
let drainInterval = null;

function getRank(v){
  if(v <= 29) return {letter:"F", desc:"Nivel Humano", cls:"F"};
  if(v <= 39) return {letter:"E", desc:"Nivel Estructural", cls:"E"};
  if(v <= 49) return {letter:"D", desc:"Nivel Pa√≠s", cls:"D"};
  if(v <= 59) return {letter:"C", desc:"Nivel Tect√≥nico", cls:"C"};
  if(v <= 69) return {letter:"B", desc:"Nivel Planetario", cls:"B"};
  if(v <= 79) return {letter:"A", desc:"Nivel Gal√°ctico", cls:"A"};
  if(v <= 84) return {letter:"S", desc:"Nivel Universal", cls:"S"};
  if(v <= 94) return {letter:"SS", desc:"Nivel Multiversal", cls:"SS"};
  return {letter:"Z", desc:"Nivel Dimensional", cls:"Z"};
}

// Ki Dimensional
function calculateKiBoost(kiDimensional){
  if(kiDimensional < 5) return 0;
  const boostPercentage = (kiDimensional - 5) * 7.8;
  return Math.min(boostPercentage, 50);
}

// Magia - C√°lculo de uso de Ki Dimensional
function calculateMagicKiUsage(magiaControl, magiaTipo){
  let baseUsage = 0;
  
  if(magiaTipo === "destructiva"){
    baseUsage = 45;
  } else {
    baseUsage = 15;
  }
  
  const controlReduction = (magiaControl / 100) * 0.6;
  const finalUsage = baseUsage * (1 - controlReduction);
  
  return Math.max(finalUsage, 5);
}

function getMagicControlLevel(control){
  if(control <= 40) return {level: "Bajo", color: "rgba(255,50,50,1)", risk: "cr√≠tico"};
  if(control <= 70) return {level: "Moderado", color: "rgba(255,140,0,1)", risk: "alto"};
  return {level: "Alto", color: "rgba(255,200,0,1)", risk: "moderado"};
}

function getMagicRiskDescription(control, tipo){
  const isDestructive = tipo === "destructiva";
  
  if(control <= 40){
    if(isDestructive){
      return "‚ö†Ô∏è PELIGRO EXTREMO: Tu control sobre la Magia Destructiva es peligrosamente bajo. El Ki Dimensional fluye sin restricci√≥n a trav√©s de tu cuerpo, causando da√±o masivo a tus c√©lulas. La muerte por colapso dimensional es casi inevitable si contin√∫as usando magia en este estado.";
    }
    return "‚ö†Ô∏è PELIGRO CR√çTICO: Tu bajo control sobre la Magia Constante te expone a niveles peligrosos de Ki Dimensional. Tu cuerpo no est√° preparado para manejar esta energ√≠a. Existe un riesgo muy alto de da√±o permanente o muerte por exposici√≥n prolongada.";
  }
  
  if(control <= 70){
    if(isDestructive){
      return "‚ö†Ô∏è RIESGO ALTO: Tu control moderado sobre la Magia Destructiva reduce el peligro, pero sigues expuesto a da√±o considerable. El Ki Dimensional todav√≠a puede da√±ar tu cuerpo seriamente. Se recomienda extrema precauci√≥n y entrenamiento adicional.";
    }
    return "‚ö†Ô∏è RIESGO MODERADO: Con control moderado, puedes manejar la Magia Constante con cierta seguridad, pero a√∫n existe riesgo de da√±o. El uso prolongado puede causar fatiga extrema y da√±o acumulativo. Procede con cautela.";
  }
  
  if(isDestructive){
    return "‚ö†Ô∏è RIESGO PRESENTE: Aunque tu control es alto, la Magia Destructiva SIEMPRE conlleva riesgo mortal. Has minimizado el peligro significativamente, pero la exposici√≥n al Ki Dimensional nunca es 100% segura. Un maestro verdadero, pero a√∫n mortal.";
  }
  return "‚úì RIESGO BAJO: Tu alto control sobre la Magia Constante te permite usarla de forma relativamente segura. El riesgo de muerte es m√≠nimo, aunque la exposici√≥n prolongada sigue requiriendo precauci√≥n. Has alcanzado un nivel de dominio respetable.";
}

// Ki Espiritual - Funciones
function getSpiritType(tipo){
  if(tipo === "normal") return {name: "Esp√≠ritu Normal", color: "rgba(0,200,255,1)"};
  if(tipo === "anexion") return {name: "Esp√≠ritu con Anexi√≥n", color: "rgba(186,85,211,1)"};
  return {name: "La Entidad", color: "rgba(100,255,150,1)"};
}

function applySpiritCopy(baseStats, spiritData){
  // LA ENTIDAD: Tiene stats propios, todos los f√≠sicos son ?? pero se potencian internamente
  if(spiritData.tipo === "entidad"){
    return baseStats.map((s) => {
      if(s[0] === "Inteligencia"){
        // Boost por corrupci√≥n mental (visible)
        return [s[0], s[1] + Math.round((spiritData.entidad.corrupcionMental / 100) * s[1])];
      }
      // Stats f√≠sicos existen pero se muestran como ??
      return [s[0], "??"];
    });
  }
  
  // ESP√çRITU NORMAL Y ANEXI√ìN: copian al objetivo
  if(!spiritData.objetivo.active){
    // No est√° copiando: retorna ?? para stats f√≠sicos
    return baseStats.map((s) => {
      if(s[0] === "Inteligencia"){
        return s; // Inteligencia siempre visible
      }
      return [s[0], "??"];
    });
  }
  
  // Est√° copiando: aplicar stats del objetivo
  const targetStats = spiritData.objetivo.stats;
  return baseStats.map((s, i) => {
    if(s[0] === "Inteligencia"){
      return s; // Inteligencia del esp√≠ritu, no copiada
    }
    
    // Stats f√≠sicos copiados
    let copiedValue = targetStats[i];
    
    if(spiritData.tipo === "anexion"){
      // Anexi√≥n: supera al objetivo
      const boost = spiritData.anexion.boostPercentage / 100;
      copiedValue = Math.round(copiedValue * (1 + boost));
    }
    // "normal" copia exactamente sin modificar
    
    return [s[0], copiedValue];
  });
}

function getSpiritWarning(tipo){
  if(tipo === "normal"){
    return "‚ö†Ô∏è VULNERABILIDAD CR√çTICA: Como esp√≠ritu, eres extremadamente vulnerable al Ki Dimensional. El contacto directo con esta energ√≠a puede destruir tu esencia por completo. Evita enfrentamientos con usuarios de Ki Dimensional a toda costa.";
  }
  if(tipo === "anexion"){
    return "‚ö†Ô∏è PRECAUCI√ìN: Aunque la Anexi√≥n te ha fortalecido considerablemente, sigues siendo vulnerable al Ki Dimensional. Tu resistencia es mayor que un esp√≠ritu normal, pero el riesgo de destrucci√≥n persiste.";
  }
  return "‚úì TOLERANCIA PARCIAL: Como Entidad, has desarrollado una resistencia √∫nica al Ki Dimensional. Puedes tolerar niveles bajos de exposici√≥n, pero sigues siendo vulnerable a concentraciones altas.";
}

function getEntityCognitiveAnalysis(){
  return "üåë Perfil de La Entidad: Tu naturaleza como ser incompleto, carente de vida y alma, ha alterado fundamentalmente tu cognici√≥n. La corrupci√≥n de tu forma no viva no deteriora tu mente, sino que la transforma en algo antinatural. Operas fuera de los par√°metros normales de inteligencia mortal, con una consciencia distorsionada que procesa informaci√≥n de maneras incomprensibles para los vivos. Tu mente corrupta es a la vez tu maldici√≥n y tu mayor ventaja.";
}

function calculateEntityAverage(baseStats, spiritData){
  // La Entidad usa sus stats base pero los potencia con su Ki
  const weights = {
    "Fuerza": 1.35,
    "Velocidad": 1.2,
    "Stamina": 1.15,
    "Durabilidad": 1.2,
    "Potencial": 1.6,
    "Precisi√≥n": 0.92,
    "Inteligencia": 0.48
  };
  
  let totalWeight = 0;
  let weightedSum = 0;
  
  for(let i = 0; i < baseStats.length; i++){
    const name = baseStats[i][0];
    let value = baseStats[i][1];
    
    // Boost por naturaleza de La Entidad
    if(name === "Inteligencia"){
      value = value + Math.round((spiritData.entidad.corrupcionMental / 100) * value);
    } else {
      // Stats f√≠sicos se potencian con cristales y control mental
      const entityBoost = (spiritData.entidad.controlMental / 100) * 0.35; // +35% m√°ximo
      const crystalBoost = spiritData.entidad.cristalesActivos ? 0.15 : 0; // +15% si cristales activos
      value = Math.round(value * (1 + entityBoost + crystalBoost));
    }
    
    let weight = weights[name] || 1;
    
    if(weight > 0){
      weightedSum += value * weight;
      totalWeight += weight;
    }
  }
  
  return Math.round(weightedSum / totalWeight);
}

// Ki Puro - Funciones
function getPureKiType(tipo, rango){
  if(tipo === "normal"){
    if(rango === "arcangel") return {name: "Arc√°ngel Puro", color: "rgba(255,255,255,1)", brightness: "Fluorescente y Cegador"};
    return {name: "√Ångel Puro", color: "rgba(255,240,180,1)", brightness: "C√°lido y Luminoso"};
  }
  if(tipo === "purgatorio"){
    // En purgatorio se invierten los brillos
    if(rango === "arcangel") return {name: "Arc√°ngel Puro del Purgatorio", color: "rgba(180,220,255,1)", brightness: "C√°lido y Luminoso"};
    return {name: "√Ångel Puro del Purgatorio", color: "rgba(150,200,255,1)", brightness: "Fluorescente y Cegador"};
  }
  return {name: "Ki Puro Maligno (Regalo de La Presentadora)", color: "rgba(255,100,100,1)", brightness: "Rojizo Fuerte con Destellos Blancos"};
}

function calculatePureKiBoost(pureData){
  if(pureData.tipo === "maligno"){
    // Ki Puro Maligno: m√°s err√°tico pero muy poderoso
    const corruptionBoost = (pureData.corrupcion / 100) * 50; // Hasta +50%
    return corruptionBoost;
  }
  
  if(pureData.tipo === "purgatorio"){
    // Ki Puro del Purgatorio: poder equilibrado
    const baseBoost = pureData.rango === "arcangel" ? 35 : 25;
    return baseBoost;
  }
  
  // Ki Puro Normal: depende de la pureza del coraz√≥n
  const purityBoost = (pureData.pureza / 100) * (pureData.rango === "arcangel" ? 40 : 30);
  return purityBoost;
}

function applyPureKiBoost(statValue, pureBoost, statName, pureData){
  // Ki Puro afecta principalmente stats espirituales y de control
  const multipliers = {
    "Fuerza": 1.0,
    "Velocidad": 1.2,
    "Stamina": 1.4,
    "Potencial": 1.8,
    "Precisi√≥n": 1.5,
    "Durabilidad": 1.1,
    "Inteligencia": pureData.tipo === "maligno" ? 0.7 : 1.3 // Maligno reduce inteligencia
  };
  
  const mult = multipliers[statName] || 1.0;
  return Math.round(statValue * (1 + (pureBoost * mult) / 100));
}

function getPureKiWarning(tipo, pureza, corrupcion){
  if(tipo === "maligno"){
    return "üî¥ CORRUPCI√ìN DEL KI PURO: Tu Ki Puro ha sido corrompido por La Presentadora. La tristeza, rencor o sed de venganza han transformado tu esencia angelical en algo err√°tico e inestable. Tu mentalidad se vuelve agresiva y tu poder crece con tu corrupci√≥n, pero pierdes claridad mental.";
  }
  
  if(tipo === "purgatorio"){
    return "ü©µ KI PURO DEL PURGATORIO: Tu Ki Puro nace de la felicidad y tiene un brillo m√°s resplandeciente. A diferencia del Ki de Demonio del Purgatorio (nacido de tristeza), tu poder proviene de emociones positivas, otorg√°ndote control y equilibrio √∫nicos.";
  }
  
  if(pureza < 60){
    return "‚ö†Ô∏è REQUISITO DE PUREZA: Tu coraz√≥n no es lo suficientemente puro. El Ki Puro requiere bondad y pureza absoluta para manifestarse correctamente. Sin un coraz√≥n puro, el Ki puede escaparse de tus manos o no responder a tu voluntad.";
  }
  
  return "‚ú® CORAZ√ìN PURO: Tu bondad y pureza te permiten manifestar el Ki Puro correctamente. Solo aquellos con corazones buenos pueden percibir y dominar esta energ√≠a celestial.";
}

function getPureCognitiveEffect(pureData, intelligenceValue){
  if(pureData.tipo === "maligno"){
    const intelligenceLoss = Math.round((pureData.corrupcion / 100) * intelligenceValue * 0.3);
    return {
      loss: intelligenceLoss,
      description: "üî¥ Corrupci√≥n Maligna: La corrupci√≥n de La Presentadora nubla tu juicio. Tu mentalidad agresiva e inestable reduce tu capacidad de razonamiento estrat√©gico en " + intelligenceLoss + " puntos. El poder viene con caos mental."
    };
  }
  
  if(pureData.tipo === "purgatorio"){
    const intelligenceGain = Math.round((pureData.rango === "arcangel" ? 0.15 : 0.10) * intelligenceValue);
    return {
      gain: intelligenceGain,
      description: "ü©µ Felicidad Celestial: El Ki Puro del Purgatorio, nacido de la felicidad, ilumina tu mente. Tu serenidad positiva aumenta tu capacidad cognitiva en " + intelligenceGain + " puntos, otorg√°ndote claridad y sabidur√≠a."
    };
  }
  
  const intelligenceGain = Math.round((pureData.pureza / 100) * (pureData.rango === "arcangel" ? 0.20 : 0.15) * intelligenceValue);
  return {
    gain: intelligenceGain,
    description: "‚ú® Pureza Divina: Tu coraz√≥n puro y bondadoso eleva tu consciencia. El Ki Puro fortalece tu mente con claridad celestial, aumentando tu inteligencia en " + intelligenceGain + " puntos."
  };
}

// Ki de Demonio
function calculateDemonBoost(kiDemonio){
  if(kiDemonio < 5) return 0;
  const boostPercentage = (kiDemonio / 100) * 35;
  return boostPercentage;
}

// Ki del Purgatorio
function calculatePurgatoryBoost(kiPurgatorio){
  if(kiPurgatorio < 5) return 0;
  const boostPercentage = (kiPurgatorio / 100) * 28;
  return boostPercentage;
}

// Ki de Vac√≠o
function calculateVoidBoost(carga, nivelDestruccion){
  let baseBoost = 0;
  if(carga <= 20) baseBoost = -10;
  else if(carga <= 40) baseBoost = 0;
  else if(carga <= 60) baseBoost = 20;
  else if(carga <= 80) baseBoost = 40;
  else baseBoost = 65;
  
  const multipliers = {
    1: 1.0, 2: 1.0, 3: 1.0,
    4: 1.3, 5: 1.3, 6: 1.3,
    7: 1.6, 8: 1.6, 9: 1.6,
    10: 2.0
  };
  
  return baseBoost * (multipliers[nivelDestruccion] || 1.0);
}

function getStaminaModifier(nivelDestruccion){
  if(nivelDestruccion <= 3) return -0.35;
  if(nivelDestruccion <= 5) return -0.20;
  if(nivelDestruccion <= 7) return 0;
  if(nivelDestruccion <= 8) return 0.15;
  if(nivelDestruccion <= 9) return 0.30;
  return 0.50;
}

function applyVoidBoost(statValue, voidBoost, statName){
  const multipliers = {
    "Fuerza": 1.8,
    "Velocidad": 1.5,
    "Stamina": 0.8,
    "Potencial": 2.2,
    "Precisi√≥n": 0.8,
    "Durabilidad": 1.7,
    "Inteligencia": 0.5
  };
  
  const mult = multipliers[statName] || 1.0;
  
  if(statName === "Stamina"){
    const staminaPenalty = getStaminaModifier(dataModel.kiVacio.nivelDestruccion);
    return Math.round(statValue * (1 + (voidBoost * mult) / 100 + staminaPenalty));
  }
  
  return Math.round(statValue * (1 + (voidBoost * mult) / 100));
}

function applyKiBoost(statValue, kiBoost, statName){
  if(statName === "Inteligencia") return statValue;
  return Math.round(statValue * (1 + kiBoost / 100));
}

function applyDemonBoost(statValue, demonBoost, statName){
  const boostedStats = ["Fuerza", "Velocidad", "Potencial", "Durabilidad"];
  if(!boostedStats.includes(statName)) return statValue;
  return Math.round(statValue * (1 + demonBoost / 100));
}

function applyPurgatoryBoost(statValue, purgBoost, statName){
  if(statName === "Fuerza"){
    return Math.round(statValue * (1 + purgBoost * 0.80 / 100));
  }
  if(statName === "Velocidad"){
    return Math.round(statValue * (1 + purgBoost * 1.10 / 100));
  }
  if(statName === "Potencial"){
    return Math.round(statValue * (1 + purgBoost * 0.50 / 100));
  }
  if(statName === "Precisi√≥n"){
    return Math.round(statValue * (1 + purgBoost * 0.70 / 100));
  }
  if(statName === "Inteligencia"){
    return Math.round(statValue * (1 + purgBoost * 0.40 / 100));
  }
  return statValue;
}

function applyDemonDebuff(intelligenceValue, kiDemonio){
  if(kiDemonio < 5) return intelligenceValue;
  const debuffPercentage = (kiDemonio / 100) * 15;
  const debuffedValue = Math.round(intelligenceValue * (1 - debuffPercentage / 100));
  return Math.max(debuffedValue, 1);
}

function getDemonRank(pct){
  if(pct < 60) return {level: "Mortal", color: "rgba(139,0,0,0.6)"};
  if(pct < 86) return {level: "Demonio del Infierno", color: "rgba(220,20,60,0.7)"};
  if(pct < 93) return {level: "Demonio Noble del Infierno", color: "rgba(255,0,0,0.8)"};
  return {level: "Realeza del Infierno", color: "rgba(255,20,0,0.9)"};
}

function getDemonDesc(pct){
  if(pct < 60) return "Posees Ki de Demonio pero a√∫n mantienes tu naturaleza mortal. El poder infernal fluye d√©bilmente en ti, sin transformarte completamente.";
  if(pct < 86) return "Eres un Demonio del Infierno verdadero. Tu poder infernal es considerable y puedes transformarte en un demonio completo en momentos de necesidad.";
  if(pct < 93) return "Eres un Demonio Noble del Infierno, con poder considerable y prestigio entre tu raza. Tu naturaleza demon√≠aca es pr√°cticamente pura.";
  return "Perteneces a la Familia Real del Infierno. Tu poder infernal es casi absoluto y tu linaje demon√≠aco es incontestable. Eres una entidad de realeza infernal.";
}

function getPurgatoryRank(pct){
  if(pct < 60) return {level: "Portador Afligido", color: "rgba(40,80,200,0.45)"};
  if(pct < 86) return {level: "Demonio del Purgatorio", color: "rgba(60,120,255,0.6)"};
  if(pct < 93) return {level: "Noble del Purgatorio", color: "rgba(90,160,255,0.75)"};
  return {level: "Realeza del Purgatorio", color: "rgba(130,200,255,0.9)"};
}

function getPurgatoryDesc(pct){
  if(pct < 60) return "Eres un alma marcada por la tristeza. El Ki del Purgatorio fluye d√©bilmente, otorgando serenidad y cambios leves.";
  if(pct < 86) return "Tu alma pertenece al Purgatorio. Tu poder nace de la melancol√≠a y el rencor; su energ√≠a es fr√≠a y sostenida.";
  if(pct < 93) return "Eres un Noble del Purgatorio. Tu Ki azul brinda dominio sereno y profundo, moldeado por la pena y la resoluci√≥n.";
  return "Perteneces a la Realeza del Purgatorio. Tu Ki es antiguo y poderoso, nutrido por siglos de rencor y tristezas transformadas en fuerza.";
}

function getVoidChargeStatus(carga){
  if(carga <= 20) return {status: "CR√çTICO", color: "rgba(200,0,0,1)", desc: "Tu poder est√° casi agotado. Debes destruir urgentemente."};
  if(carga <= 40) return {status: "Bajo", color: "rgba(255,100,0,1)", desc: "Necesitas destruir pronto para mantener tu poder."};
  if(carga <= 60) return {status: "Medio", color: "rgba(255,180,0,1)", desc: "Tu poder est√° estable pero necesitar√°s destruir eventualmente."};
  if(carga <= 80) return {status: "Alto", color: "rgba(255,200,80,1)", desc: "Tu Ki de Vac√≠o fluye con gran intensidad."};
  return {status: "M√ÅXIMO", color: "rgba(255,220,100,1)", desc: "Tu poder rivaliza con el Ki Dimensional mismo."};
}

function getVoidDestructionLevel(nivel){
  const levels = {
    1: "Iniciado del Vac√≠o",
    2: "Iniciado del Vac√≠o",
    3: "Iniciado del Vac√≠o",
    4: "Destructor Planetario",
    5: "Destructor Planetario",
    6: "Destructor Planetario",
    7: "Aniquilador Dimensional",
    8: "Aniquilador Dimensional",
    9: "Aniquilador Dimensional",
    10: "Devorador del Multiverso"
  };
  return levels[nivel] || "Desconocido";
}

function calculateVoidDrainRate(nivelDestruccion, currentCarga){
  if(currentCarga >= 100){
    return 2.0;
  }
  
  if(nivelDestruccion >= 9) return 0.01;
  if(nivelDestruccion >= 6) return 0.15;
  
  if(currentCarga > 70){
    return 0.5;
  }
  return 0.3;
}

function calculateVoidRegenRate(nivelDestruccion, currentCarga){
  if(nivelDestruccion < 7) return 0;
  
  if(currentCarga >= 90 && currentCarga <= 100){
    return 0;
  }
  
  const regenRates = {
    7: 0.08,
    8: 0.15,
    9: 0.25,
    10: 0.40
  };
  
  return regenRates[nivelDestruccion] || 0;
}

function startVoidDrain(){
  if(drainInterval) clearInterval(drainInterval);
  
  if(dataModel.kiVacio && dataModel.kiVacio.active){
    drainInterval = setInterval(() => {
      const drainRate = calculateVoidDrainRate(dataModel.kiVacio.nivelDestruccion, dataModel.kiVacio.carga);
      const regenRate = calculateVoidRegenRate(dataModel.kiVacio.nivelDestruccion, dataModel.kiVacio.carga);
      
      const netChange = regenRate - drainRate;
      
      dataModel.kiVacio.carga = Math.max(0, Math.min(100, dataModel.kiVacio.carga + netChange));
      
      updateDisplay();
    }, 1000);
  }
}

    function calculateWeightedAverage(stats, kiBoost, demonBoost, purgBoost, voidBoost, hasVoid, pureBoost){
      const weights = {
        "Fuerza": 1.35,
        "Velocidad": 1.2,
        "Stamina": 1.15,
        "Durabilidad": 1.2,
        "Potencial": 1.6,
        "Precisi√≥n": 0.92,
        "Inteligencia": 0.48
      };

      let totalWeight = 0;
      let weightedSum = 0;

      for(let i = 0; i < stats.length; i++){
        const name = stats[i][0];
        let value = stats[i][1];
        
        if(hasVoid){
          value = applyVoidBoost(value, voidBoost, name);
        } else {
          if(name === "Inteligencia" && demonBoost > 0){
            value = applyDemonDebuff(value, dataModel.kiDemonio);
          }

          if(kiBoost > 0 && name !== "Inteligencia"){
            value = applyKiBoost(value, kiBoost, name);
          }

          if(demonBoost > 0){
            value = applyDemonBoost(value, demonBoost, name);
          }

          if(purgBoost > 0){
            value = applyPurgatoryBoost(value, purgBoost, name);
          }

          if(pureBoost > 0){
            value = applyPureKiBoost(value, pureBoost, name, dataModel.kiPuro);
          }
        }
        
        let weight = weights[name] || 1;
        
        if(weight > 0){
          weightedSum += value * weight;
          totalWeight += weight;
        }
      }

      return Math.round(weightedSum / totalWeight);
    }

function getCognitiveAnalysis(intelligenceValue, rankLetter){
  const analyses = {
    F: {
      low: "Inteligencia Limitada: Con menos del 20% de capacidad cognitiva, este personaje conf√≠a principalmente en instintos y fuerza bruta. El razonamiento complejo no es su fuerte.",
      medium: "Inteligencia B√°sica: Entre 20-25%, posee habilidades de pensamiento muy b√°sicas. Puede seguir √≥rdenes simples pero carece de profundidad estrat√©gica.",
      high: "Inteligencia Funcional: Entre 26-29%, muestra capacidad de aprendizaje limitada pero funcional. Puede adaptarse a situaciones simples."
    },
    E: {
      low: "Inteligencia Combativa B√°sica: Entre 30-33%, depende de entrenamiento repetitivo m√°s que de innovaci√≥n t√°ctica. Efectivo pero predecible.",
      medium: "Inteligencia T√°ctica Elemental: Entre 34-36%, este guerrero puede leer el campo de batalla con competencia b√°sica. Conoce cu√°ndo atacar y cu√°ndo retirarse.",
      high: "Inteligencia Estructural: Entre 37-39%, combina experiencia con pensamiento anal√≠tico b√°sico. Puede anticipar movimientos enemigos simples."
    },
    D: {
      low: "Inteligencia Instintiva: Entre 40-43%, su poder compensa la falta de genio estrat√©gico. Opera m√°s por reflejos perfeccionados que por planificaci√≥n compleja.",
      medium: "Inteligencia Competente: Entre 44-46%, equilibra fuerza y cerebro. Puede elaborar planes efectivos aunque no sean particularmente innovadores.",
      high: "Inteligencia Avanzada: Entre 47-49%, es un estratega capaz que complementa su poder con t√°cticas bien pensadas."
    },
    C: {
      low: "Poder sobre Intelecto: Entre 50-53%, este monstruo conf√≠a en devastaci√≥n pura con algo de c√°lculo. La sutileza no es prioritaria cuando tienes tanto poder.",
      medium: "Inteligencia Destructiva: Entre 54-56%, puede planificar ataques coordinados. Su mente funciona en t√©rminos de m√°ximo da√±o con eficiencia calculada.",
      high: "Inteligencia T√°ctica Superior: Entre 57-59%, combina poder catastr√≥fico con planificaci√≥n estrat√©gica. Un enemigo verdaderamente peligroso."
    },
    B: {
      low: "Fuerza Primordial Calculada: Entre 60-63%, es una bestia de poder con astucia creciente. Su intelecto complementa su fuerza devastadora.",
      medium: "Inteligencia Planetaria: Entre 64-66%, puede comprender sistemas complejos y ecosistemas. Su mente opera a escala continental.",
      high: "Intelecto Avanzado: Entre 67-69%, es tan peligroso mentalmente como lo es f√≠sicamente. Puede planificar la conquista de mundos."
    },
    A: {
      low: "Mente Gal√°ctica Emergente: Entre 70-73%, posee capacidades cognitivas que superan a casi cualquier ser mortal. Comprende conceptos c√≥smicos.",
      medium: "Inteligencia Gal√°ctica: Entre 74-76%, muestra capacidades anal√≠ticas extraordinarias. Puede dise√±ar planes a escala gal√°ctica con maestr√≠a.",
      high: "Genio C√≥smico: Entre 77-79%, es un verdadero estratega gal√°ctico. Su mente puede comprender y manipular sistemas estelares completos."
    },
    S: {
      low: "Intelecto Universal: Entre 80-81%, posee capacidades cognitivas que desaf√≠an la comprensi√≥n mortal. Puede procesar informaci√≥n a niveles universales.",
      medium: "Inteligencia Sobrehumana: Entre 82-83%, su intelecto trascendental le permite comprender conceptos de naturaleza universal con claridad absoluta.",
      high: "Mente Omnisciente: Entre 84%, su intelecto alcanza niveles donde conocimiento y predicci√≥n se fusionan. Una mente universal verdadera."
    },
    SS: {
      low: "Consciencia Multiversal: Entre 85-89%, su capacidad cognitiva trasciende dimensiones. Comprende conceptos m√°s all√° de la l√≥gica tridimensional.",
      medium: "Inteligencia Multidimensional: Entre 90-92%, comprende la naturaleza misma de la existencia multiversal. Su pensamiento afecta m√∫ltiples realidades.",
      high: "Intelecto Absoluto: Entre 93-94%, su mente abarca m√∫ltiples realidades simult√°neamente. Puede procesar informaci√≥n de infinitos universos."
    },
    Z: {
      low: "Inteligencia Dimensional: Sobre 95%, piensa m√°s all√° de toda l√≥gica conocida. Su mente existe en un plano donde el pensamiento y la realidad convergen.",
      medium: "Consciencia Trascendental: Con este nivel, su intelecto puede reescribir las reglas del pensamiento mismo. Opera fuera de toda comprensi√≥n mortal.",
      high: "Omnisciencia Absoluta: En la c√∫spide del poder mental, su intelecto abarca toda existencia posible. Para mortales, su pensamiento es indistinguible de la omnisciencia total."
    }
  };

  if(!analyses[rankLetter]){ return null; }

  let level = "low";
  const ranges = {
    F: { medium: 20, high: 26 },
    E: { medium: 34, high: 37 },
    D: { medium: 44, high: 47 },
    C: { medium: 54, high: 57 },
    B: { medium: 64, high: 67 },
    A: { medium: 74, high: 77 },
    S: { medium: 82, high: 84 },
    SS: { medium: 90, high: 93 },
    Z: { medium: 97, high: 99 }
  };

  if(ranges[rankLetter]){
    if(intelligenceValue >= ranges[rankLetter].high) level = "high";
    else if(intelligenceValue >= ranges[rankLetter].medium) level = "medium";
  }

  return analyses[rankLetter][level];
}

const rankDescriptions = {
  F: "Las personas con este rango no destacan particularmente en habilidades extraordinarias, pero representan el punto de partida y el est√°ndar com√∫n a trav√©s de la mayor√≠a de dimensiones. Son los cimientos sobre los que todo otro poder se construye.",
  E: "Las personas con este rango poseen entrenamiento y cierto talento. Usualmente son vistos como soldados, artistas marciales o combatientes experimentados. Superan al humano promedio en capacidades f√≠sicas y estrat√©gicas.",
  D: "Las personas con este rango sobresalen por habilidades excepcionales que superan ampliamente las de los mortales comunes. Son vistos como superh√©roes... o amenazas capaces de alterar el equilibrio de una naci√≥n entera.",
  C: "Las personas con este rango son considerados monstruos en potencia. Su poder y habilidades son tan inmensos que pueden causar destrucci√≥n masiva, arrasando ciudades o incluso borrando civilizaciones enteras del mapa.",
  B: "Las personas con este rango son aut√©nticas bestias de poder. Escapan por completo de la escala humana, y su sola presencia puede alterar ecosistemas. Son capaces de destruir mundos enteros con su fuerza.",
  A: "Las personas con este rango pueden ser confundidas con deidades. Su poder es tan colosal que podr√≠an alterar la vida en una galaxia completa. Dado el tiempo y la intenci√≥n suficiente, podr√≠an moldear sistemas estelares a su voluntad.",
  S: "Las personas con este rango sobrepasan los l√≠mites de lo imaginable para los mortales. Solo aut√©nticos dioses podr√≠an operar en este nivel. Su poder es tal, que pueden llegar a destruir universos enteros con su fuerza. Estos seres pueden proteger... o para destruir. Aut√©nticos dioses.",
  SS: "Las personas con este rango est√°n m√°s all√° de la l√≥gica y la comprensi√≥n. Son entidades que desaf√≠an las leyes mismas de la existencia con su poder, con una cantidad de Ki Dimensional, o de poder bruto, tan elevada que son capaces de afectar m√∫ltiples universos simult√°neamente, inclusive llegando a afectar la Dimensi√≥n de alguna forma. Verdaderos demonios o deidades absolutas.",
  Z: "Las personas con este rango operan en un plano completamente ajeno a toda raz√≥n o posibilidad. Su poder trasciende dimensiones, llegando a aguantar cantidades casi infinitas de Ki Dimensional; todo es posible para ellos. Para los simples mortales, enfrentarse a una entidad de este nivel es tan absurdo como intentar desafiar el infinito."
};

function updateDisplay(){
  const hasSpirit = dataModel.kiEspiritual && dataModel.kiEspiritual.active;
  const hasPure = dataModel.kiPuro && dataModel.kiPuro.active;
  const hasVoid = dataModel.kiVacio && dataModel.kiVacio.active;
  const pureBoost = hasPure && !hasVoid && !hasSpirit ? calculatePureKiBoost(dataModel.kiPuro) : 0;
  console.log("DEBUG - pureBoost:", pureBoost, "hasPure:", hasPure, "hasVoid:", hasVoid, "hasSpirit:", hasSpirit);
  const kiBoost = hasVoid ? 0 : calculateKiBoost(dataModel.kiDimensional);
  const demonBoost = hasVoid ? 0 : calculateDemonBoost(dataModel.kiDemonio);
  const purgBoost = hasVoid ? 0 : calculatePurgatoryBoost(dataModel.kiPurgatorio);
  const voidBoost = hasVoid ? calculateVoidBoost(dataModel.kiVacio.carga, dataModel.kiVacio.nivelDestruccion) : 0;

  const hasDemonBoost = !hasVoid && dataModel.kiDemonio >= 5;
  const hasPurgBoost = !hasVoid && dataModel.kiPurgatorio >= 5;

  // Actualizar Ki Display
  const kiDisplay = document.getElementById('kiDisplay');
  if(hasVoid){
    kiDisplay.classList.add('devoured');
    kiDisplay.textContent = `Ki Dimensional: ${dataModel.kiDimensional}% [DEVORADO]`;
  } else {
    kiDisplay.classList.remove('devoured');
  
    let kiText = `Ki Dimensional: ${dataModel.kiDimensional}%`;
    if(dataModel.magia && dataModel.magia.active){
      const magicUsage = calculateMagicKiUsage(dataModel.magia.control, dataModel.magia.tipo);
      kiText += ` (Uso Magia: -${Math.round(magicUsage)}%)`;
    }
  
    kiDisplay.textContent = kiText;
    if(dataModel.kiDimensional >= 5){
      kiDisplay.classList.add('active');
    }
  }

  // Aplicar Ki Espiritual si est√° activo
  let displayStats = dataModel.stats;
  if(hasSpirit && !hasVoid){
    displayStats = applySpiritCopy(dataModel.stats, dataModel.kiEspiritual);
  }

  const table = document.getElementById('statsTable');
  table.innerHTML = '';
  
  let intelligenceValue = 0;
  let finalIntelligenceValue = 0;
  let hasUnknownStats = false;
  
  for(let i = 0; i < displayStats.length; i++){
    const k = displayStats[i][0];
    const v = displayStats[i][1];
    
    // Manejar stats con ??
    const isUnknown = v === "??";
    if(isUnknown) hasUnknownStats = true;
    
    if(k === "Inteligencia" && !isUnknown){
      intelligenceValue = v;
      if(hasVoid){
        finalIntelligenceValue = applyVoidBoost(v, voidBoost, "Inteligencia");
      } else {
        finalIntelligenceValue = hasDemonBoost ? applyDemonDebuff(v, dataModel.kiDemonio) : v;
        if(hasPurgBoost){
          finalIntelligenceValue = applyPurgatoryBoost(finalIntelligenceValue, purgBoost, "Inteligencia");
        }
        
        // Ki Puro afecta la inteligencia (solo si NO hay Spirit)
        if(pureBoost > 0 && !hasSpirit){
          const pureEffect = getPureCognitiveEffect(dataModel.kiPuro, finalIntelligenceValue);
          if(pureEffect.loss){
            finalIntelligenceValue -= pureEffect.loss;
          } else if(pureEffect.gain){
            finalIntelligenceValue += pureEffect.gain;
          }
        }
      }
    }

    let displayValue = v;
    
    if(!isUnknown){
      if(hasVoid){
        displayValue = applyVoidBoost(displayValue, voidBoost, k);
      } else {
        if(k === "Inteligencia" && hasDemonBoost){
          displayValue = applyDemonDebuff(v, dataModel.kiDemonio);
          if(hasPurgBoost){
            displayValue = applyPurgatoryBoost(displayValue, purgBoost, "Inteligencia");
          }
        } else {
          if(kiBoost > 0 && k !== "Inteligencia"){
            displayValue = applyKiBoost(displayValue, kiBoost, k);
          }
          if(hasDemonBoost){
            displayValue = applyDemonBoost(displayValue, demonBoost, k);
          }
          if(hasPurgBoost){
            displayValue = applyPurgatoryBoost(displayValue, purgBoost, k);
          }
          if(pureBoost > 0){
            displayValue = applyPureKiBoost(displayValue, pureBoost, k, dataModel.kiPuro);
          }
        }
      }
    }

    const rank = isUnknown ? {letter: "?", desc: "Desconocido"} : getRank(displayValue);

    const tr = document.createElement('tr');
    const tdName = document.createElement('td'); 
    tdName.className = 'stat-name'; 
    tdName.textContent = k;
    
    const tdVal = document.createElement('td'); 
    tdVal.className = isUnknown ? 'stat-value unknown' : 'stat-value';
    tdVal.textContent = displayValue;
    
    const tdRank = document.createElement('td'); 
    tdRank.className = 'stat-rank';
    
    if(!isUnknown){
      const span = document.createElement('span');
      span.className = 'badge badge-' + rank.letter;
      span.textContent = rank.letter;
      span.title = rank.desc;
      tdRank.appendChild(span);
    } else {
      tdRank.textContent = '?';
      tdRank.style.color = 'rgba(150,150,150,0.6)';
      tdRank.style.fontStyle = 'italic';
    }

    tr.appendChild(tdName); 
    tr.appendChild(tdVal); 
    tr.appendChild(tdRank);
    table.appendChild(tr);
  }

  // Promedio: ?? si tiene stats desconocidos
  let avg;
  if(hasSpirit && dataModel.kiEspiritual.tipo === "entidad"){
    // La Entidad tiene promedio calculado con sus stats base + boosts
    avg = calculateEntityAverage(dataModel.stats, dataModel.kiEspiritual);
  } else if(hasUnknownStats){
    avg = "??";
  } else {
    avg = calculateWeightedAverage(dataModel.stats, kiBoost, demonBoost, purgBoost, voidBoost, hasVoid, pureBoost);
  }
  document.getElementById('average').textContent = avg;

  const globalRank = hasUnknownStats ? {letter: "?", desc: "Nivel Desconocido", cls: "F"} : getRank(avg);
  const rankCard = document.getElementById('rankCard');
  const rankLetterEl = document.getElementById('rankLetter');
  const rankSubEl = document.getElementById('rankSub');

  rankCard.className = 'rank-card-top rank-' + globalRank.cls;
  rankLetterEl.textContent = globalRank.letter;
  rankSubEl.textContent = globalRank.desc;

  if(globalRank.letter.length > 1){
    rankLetterEl.style.fontSize = '56px';
    rankLetterEl.style.letterSpacing = '4px';
  } else {
    rankLetterEl.style.fontSize = '72px';
    rankLetterEl.style.letterSpacing = '';
  }

  const descBox = document.getElementById('rankDescription');
  if(hasUnknownStats){
    descBox.innerHTML = '<strong>? - Nivel Desconocido</strong>Este ser opera m√°s all√° de las mediciones convencionales. Su verdadero poder permanece oculto, fluctuante o inmedible por m√©todos est√°ndar.';
  } else {
    descBox.innerHTML = '<strong>' + globalRank.letter + ' - ' + globalRank.desc + '</strong>' + rankDescriptions[globalRank.letter];
  }

  // Perfil cognitivo
  const cogBox = document.getElementById('cognitiveProfile');
  const intelligenceRank = getRank(finalIntelligenceValue);
  
  // An√°lisis especial para La Entidad
  if(hasSpirit && dataModel.kiEspiritual.tipo === "entidad"){
    const entityAnalysis = getEntityCognitiveAnalysis();
    cogBox.innerHTML = '<strong>üåë Perfil de La Entidad</strong>' + entityAnalysis;
    cogBox.classList.add('show');
    cogBox.classList.add('high-intelligence');
  } else {
    const cogAnalysis = getCognitiveAnalysis(finalIntelligenceValue, intelligenceRank.letter);
    if(cogAnalysis){
      const isHighIntelligence = finalIntelligenceValue >= 67;
      const emoji = isHighIntelligence ? '‚ö° ' : '';
      let cogHTML = '<strong>' + emoji + 'Perfil Cognitivo</strong>' + cogAnalysis;
    
      if(!hasVoid && hasDemonBoost && dataModel.kiDemonio >= 5){
        const intelligenceLoss = intelligenceValue - finalIntelligenceValue;
        cogHTML += '<span class="demon-warning"><strong>‚ö†Ô∏è Corrupci√≥n Demon√≠aca:</strong> El Ki de Demonio nubla tu razonamiento y pensamiento estrat√©gico. Tu agresividad infernal reduce tu capacidad cognitiva en ' + intelligenceLoss + ' puntos. La sed de poder viene con un precio mental.</span>';
      }

      if(!hasVoid && hasPurgBoost && dataModel.kiPurgatorio >= 5){
        cogHTML += '<span class="purg-warning"><strong>ü©µ Influencia del Purgatorio:</strong> El Ki del Purgatorio enfr√≠a tus emociones y pensamientos, otorgando serenidad y lucidez, pero tambi√©n cierta apat√≠a ante el mundo. Esta calma puede reducir la motivaci√≥n emotiva aunque permita una visi√≥n fr√≠a y clara de la situaci√≥n.</span>';
      }
    
      cogBox.innerHTML = cogHTML;
      if(isHighIntelligence){
        cogBox.classList.add('high-intelligence');
      } else {
        cogBox.classList.remove('high-intelligence');
      }
      cogBox.classList.add('show');

      // Advertencia de Magia (debajo del perfil cognitivo)
      if(!hasVoid && dataModel.magia && dataModel.magia.active){
        const magicControl = getMagicControlLevel(dataModel.magia.control);
        const riskDesc = getMagicRiskDescription(dataModel.magia.control, dataModel.magia.tipo);
      
        let warningClass = 'magic-warning';
        if(dataModel.magia.control > 40 && dataModel.magia.control <= 70){
          warningClass += ' moderate';
        } else if(dataModel.magia.control > 70){
          warningClass += ' high';
        }
      
        const warningHTML = '<strong>‚ö° ADVERTENCIA DE EXPOSICI√ìN M√ÅGICA</strong>' + riskDesc;
      
        if(cogBox.classList.contains('show')){
          let existingWarning = cogBox.querySelector('.magic-warning');
          if(existingWarning){
            existingWarning.className = warningClass;
            existingWarning.innerHTML = warningHTML;
          } else {
            const warningDiv = document.createElement('span');
            warningDiv.className = warningClass;
            warningDiv.innerHTML = warningHTML;
            cogBox.appendChild(warningDiv);
          }
        }
      }

      // Efecto cognitivo del Ki Puro
      if(!hasVoid && !hasSpirit && hasPure){
        const pureEffect = getPureCognitiveEffect(dataModel.kiPuro, intelligenceValue);
        let pureWarningClass = 'pure-warning';
        if(dataModel.kiPuro.tipo === "maligno"){
          pureWarningClass += ' corrupted';
        }
        
        const pureEffectHTML = '<strong>' + (dataModel.kiPuro.tipo === "maligno" ? 'üåë' : '‚ú®') + '</strong> ' + pureEffect.description;
        
        if(cogBox.classList.contains('show')){
          let existingPureWarning = cogBox.querySelector('.pure-warning');
          if(existingPureWarning){
            existingPureWarning.className = pureWarningClass;
            existingPureWarning.innerHTML = pureEffectHTML;
          } else {
            const pureWarningDiv = document.createElement('span');
            pureWarningDiv.className = pureWarningClass;
            pureWarningDiv.innerHTML = pureEffectHTML;
            cogBox.appendChild(pureWarningDiv);
          }
        }
      }
    }
  }

// Ki de Demonio
const demonBox = document.getElementById('demonKiDisplay');

// Si ya est√° mostrado, solo actualizar la barra sin recrear HTML
if(demonBox.classList.contains('show')){
  const demonBar = document.getElementById('demonKiBar');
  if(demonBar){
    if(hasVoid){
      demonBox.classList.add('devoured');
    } else {
      demonBox.classList.remove('devoured');
      if(hasDemonBoost){
        demonBar.style.width = dataModel.kiDemonio + '%';
        const barIntensity = dataModel.kiDemonio / 100;
        demonBar.style.background = 'linear-gradient(90deg, rgba(' + (220 * barIntensity) + ',20,60,' + (0.5 + barIntensity * 0.4) + '), rgba(255,' + (100 * barIntensity) + ',' + (100 * barIntensity) + ',' + (0.6 + barIntensity * 0.4) + '))';
      }
    }
  }
} else {
  // Solo crear el HTML la primera vez
  if((hasVoid && dataModel.kiDemonio >= 5) || hasDemonBoost){
    const demonRank = getDemonRank(dataModel.kiDemonio);
    const demonDesc = getDemonDesc(dataModel.kiDemonio);
    const isRoyalty = dataModel.kiDemonio >= 93;
    
    let demonHTML = '<strong>üî• Ki de Demonio del Infierno' + (hasVoid ? ' [DEVORADO]' : '') + '</strong>';
    demonHTML += '<div class="demon-ki-percentage">Porcentaje: ' + dataModel.kiDemonio + '%</div>';
    demonHTML += '<div class="demon-ki-level">Rango: ' + demonRank.level + '</div>';
    demonHTML += '<div class="demon-ki-bar-container"><div class="demon-ki-bar" id="demonKiBar"></div></div>';
    demonHTML += '<div class="demon-ki-description">' + demonDesc + '</div>';
    
    demonBox.innerHTML = demonHTML;
    demonBox.classList.add('show');
    if(hasVoid){
      demonBox.classList.add('devoured');
    }
    if(isRoyalty){
      demonBox.classList.add('royalty');
    }
    
    setTimeout(() => {
      const bar = document.getElementById('demonKiBar');
      if(bar){
        bar.style.width = dataModel.kiDemonio + '%';
        const barIntensity = dataModel.kiDemonio / 100;
        bar.style.background = 'linear-gradient(90deg, rgba(' + (220 * barIntensity) + ',20,60,' + (0.5 + barIntensity * 0.4) + '), rgba(255,' + (100 * barIntensity) + ',' + (100 * barIntensity) + ',' + (0.6 + barIntensity * 0.4) + '))';
      }
    }, 100);
  } else {
    demonBox.classList.remove('show');
  }
}

// Ki del Purgatorio
const purgBox = document.getElementById('purgatoryKiDisplay');

// Si ya est√° mostrado, solo actualizar la barra sin recrear HTML
if(purgBox.classList.contains('show')){
  const purgBar = document.getElementById('purgatoryKiBar');
  if(purgBar){
    if(hasVoid){
      purgBox.classList.add('devoured');
    } else {
      purgBox.classList.remove('devoured');
      if(hasPurgBoost){
        purgBar.style.width = dataModel.kiPurgatorio + '%';
        const barIntensity = dataModel.kiPurgatorio / 100;
        const r = Math.floor(30 * (1 - barIntensity));
        const g = Math.floor(100 + (155 * barIntensity));
        const b = 255;
        const alpha = 0.5 + barIntensity * 0.45;
        purgBar.style.background = 'linear-gradient(90deg, rgba(' + r + ',' + g + ',' + b + ',' + alpha + '), rgba(' + (r+60) + ',' + (g+40) + ',' + b + ',' + (alpha + 0.08) + '))';
      }
    }
  }
} else {
  // Solo crear el HTML la primera vez
  if((hasVoid && dataModel.kiPurgatorio >= 5) || hasPurgBoost){
    const purgRank = getPurgatoryRank(dataModel.kiPurgatorio);
    const purgDesc = getPurgatoryDesc(dataModel.kiPurgatorio);
    const isRoyaltyPurg = dataModel.kiPurgatorio >= 93;

    let purgHTML = '<div class="purgatory-ki-title">üî∑ Ki de Demonio del Purgatorio' + (hasVoid ? ' [DEVORADO]' : '') + '</div>';
    purgHTML += '<div class="purgatory-ki-percentage">Porcentaje: ' + dataModel.kiPurgatorio + '%</div>';
    purgHTML += '<div class="purgatory-ki-level">Rango: ' + purgRank.level + '</div>';
    purgHTML += '<div class="purgatory-ki-bar-container"><div class="purgatory-ki-bar" id="purgatoryKiBar"></div></div>';
    purgHTML += '<div class="purgatory-ki-info">' + purgDesc + '</div>';

    purgBox.innerHTML = purgHTML;
    purgBox.classList.add('show');
    if(hasVoid){
      purgBox.classList.add('devoured');
    }
    if(isRoyaltyPurg){
      purgBox.classList.add('royalty');
    }

    setTimeout(() => {
      const bar = document.getElementById('purgatoryKiBar');
      if(bar){
        bar.style.width = dataModel.kiPurgatorio + '%';
        const barIntensity = dataModel.kiPurgatorio / 100;
        const r = Math.floor(30 * (1 - barIntensity));
        const g = Math.floor(100 + (155 * barIntensity));
        const b = 255;
        const alpha = 0.5 + barIntensity * 0.45;
        bar.style.background = 'linear-gradient(90deg, rgba(' + r + ',' + g + ',' + b + ',' + alpha + '), rgba(' + (r+60) + ',' + (g+40) + ',' + b + ',' + (alpha + 0.08) + '))';
      }
    }, 120);
  } else {
    purgBox.classList.remove('show');
  }
}

// Ki de Vac√≠o
const voidBox = document.getElementById('voidKiDisplay');

// Actualizar solo el porcentaje sin recrear HTML
if(hasVoid && voidBox.classList.contains('show')){
  const voidBar = document.getElementById('voidKiBar');
  const voidCharge = document.querySelector('.void-ki-charge');
  const voidStatusDesc = document.getElementById('voidStatusDesc');
  
  if(voidBar && voidCharge && voidStatusDesc){
    const chargeStatus = getVoidChargeStatus(dataModel.kiVacio.carga);
    voidBar.style.width = dataModel.kiVacio.carga + '%';
    voidCharge.style.color = chargeStatus.color;
    voidCharge.textContent = 'Estado: ' + chargeStatus.status + ' (' + Math.round(dataModel.kiVacio.carga) + '%)';
    voidStatusDesc.textContent = chargeStatus.desc;
    
    if(dataModel.kiVacio.carga >= 90 && dataModel.kiVacio.carga <= 100){
      voidBar.classList.add('auto-regulating');
    } else {
      voidBar.classList.remove('auto-regulating');
    }
    
    // Solo actualizar chart si cambi√≥ el promedio o si es la primera vez
    const currentAvg = calculateWeightedAverage(dataModel.stats, kiBoost, demonBoost, purgBoost, voidBoost, hasVoid);
    if(!window.lastAvg || window.lastAvg !== currentAvg || !chartInstance){
      updateChart(hasVoid, kiBoost, demonBoost, purgBoost, voidBoost, pureBoost);
      updateParticles(globalRank.cls, hasVoid);
      window.lastAvg = currentAvg;
    }
    return;
  }
}

// Solo crear el HTML la primera vez
if(hasVoid && !voidBox.classList.contains('show')){
  const chargeStatus = getVoidChargeStatus(dataModel.kiVacio.carga);
  const destructionLevel = getVoidDestructionLevel(dataModel.kiVacio.nivelDestruccion);
  
  let voidHTML = '<strong>‚ö´ Ki de Vac√≠o (Â§ú, Yoru)</strong>';
    voidHTML += '<div class="void-ki-charge" style="color:' + chargeStatus.color + '">Estado: ' + chargeStatus.status + ' (' + Math.round(dataModel.kiVacio.carga) + '%)</div>';
    voidHTML += '<div class="void-ki-bar-container"><div class="void-ki-bar" id="voidKiBar"></div></div>';
    
    voidHTML += '<div class="void-control">';
    voidHTML += '<label>Ajustar Carga (0-100%)</label>';
    voidHTML += '<input type="range" min="0" max="100" value="' + dataModel.kiVacio.carga + '" class="void-slider" id="cargaSlider">';
    voidHTML += '</div>';
    
    voidHTML += '<div class="void-ki-level">Nivel: ' + destructionLevel + ' (' + dataModel.kiVacio.nivelDestruccion + '/10)</div>';
    
    voidHTML += '<div class="void-control">';
    voidHTML += '<label>Ajustar Nivel de Destrucci√≥n (1-10)</label>';
    voidHTML += '<input type="range" min="1" max="10" value="' + dataModel.kiVacio.nivelDestruccion + '" class="void-slider" id="nivelSlider">';
    voidHTML += '</div>';
    
    voidHTML += '<div id="voidStatusDesc" style="font-size:12px; margin-top:10px; color:rgba(255,200,150,0.9);">' + chargeStatus.desc + '</div>';
    voidHTML += '<div class="void-ki-warning">‚ö†Ô∏è Tu Ki normal ha sido absorbido por el vac√≠o. Debes destruir constantemente para mantener tu poder. La destrucci√≥n es tu √∫nica fuente de energ√≠a.</div>';
    
    voidBox.innerHTML = voidHTML;
    voidBox.classList.add('show');
    
    setTimeout(() => {
      const voidBar = document.getElementById('voidKiBar');
      if(voidBar){
        voidBar.style.width = dataModel.kiVacio.carga + '%';
        
        if(dataModel.kiVacio.carga >= 90 && dataModel.kiVacio.carga <= 100){
          voidBar.classList.add('auto-regulating');
        } else {
          voidBar.classList.remove('auto-regulating');
        }
      }
      
      const cargaSlider = document.getElementById('cargaSlider');
      const nivelSlider = document.getElementById('nivelSlider');
      
      if(cargaSlider){
        cargaSlider.addEventListener('input', (e) => {
          dataModel.kiVacio.carga = parseInt(e.target.value);
          updateDisplay();
        });
      }
      
      if(nivelSlider){
        nivelSlider.addEventListener('input', (e) => {
          dataModel.kiVacio.nivelDestruccion = parseInt(e.target.value);
          updateDisplay();
        });
      }
    }, 100);
} else {
    voidBox.classList.remove('show');
  }

// Display de Magia
const magicBox = document.getElementById('magicDisplay');

if(magicBox.classList.contains('show')){
  const magicBar = document.getElementById('magicControlBar');
  if(magicBar && dataModel.magia && dataModel.magia.active && !hasVoid){
    magicBar.style.width = dataModel.magia.control + '%';
    const controlLevel = getMagicControlLevel(dataModel.magia.control);
    magicBar.style.background = 'linear-gradient(90deg, rgba(138,43,226,0.8), ' + controlLevel.color + ')';
  }
} else {
  if(!hasVoid && dataModel.magia && dataModel.magia.active){
    const magicUsage = calculateMagicKiUsage(dataModel.magia.control, dataModel.magia.tipo);
    const controlLevel = getMagicControlLevel(dataModel.magia.control);
    const isDestructive = dataModel.magia.tipo === "destructiva";
    
    const tipoDisplay = isDestructive ? "Magia Destructiva" : "Magia Constante";
    const tipoDesc = isDestructive 
      ? "La Magia Destructiva es extremadamente poderosa pero altamente peligrosa. Su alta concentraci√≥n de Ki Dimensional la hace letal tanto para enemigos como para el usuario."
      : "La Magia Constante es la forma m√°s com√∫n y segura de magia. Aunque menos poderosa que la Destructiva, es mucho m√°s controlable y menos riesgosa para el portador.";
    
    let magicHTML = '<strong>‚ú® Sistema de Magia</strong>';
    magicHTML += '<div class="magic-type">Tipo: ' + tipoDisplay + '</div>';
    magicHTML += '<div class="magic-control-level">Control: ' + controlLevel.level + ' (' + dataModel.magia.control + '%)</div>';
    magicHTML += '<div class="magic-control-bar-container"><div class="magic-control-bar" id="magicControlBar"></div></div>';
    magicHTML += '<div class="magic-ki-usage">Uso de Ki Dimensional: ' + Math.round(magicUsage) + '%<br>Riesgo de Mortalidad: ' + controlLevel.risk.toUpperCase() + '</div>';
    magicHTML += '<div class="magic-description">' + tipoDesc + '</div>';
    
    magicBox.innerHTML = magicHTML;
    magicBox.classList.add('show');
    if(isDestructive){
      magicBox.classList.add('destructive');
    }
    
    setTimeout(() => {
      const bar = document.getElementById('magicControlBar');
      if(bar){
        bar.style.width = dataModel.magia.control + '%';
        bar.style.background = 'linear-gradient(90deg, rgba(138,43,226,0.8), ' + controlLevel.color + ')';
      }
    }, 100);
  } else {
    magicBox.classList.remove('show');
  }
}

// Display de Ki Espiritual
const spiritBox = document.getElementById('spiritDisplay');

if(spiritBox.classList.contains('show')){
  // Solo actualizar si ya est√° mostrado
  if(hasSpirit && !hasVoid){
    // Actualizar barras si es necesario
    if(dataModel.kiEspiritual.tipo === "entidad"){
      const controlBar = document.getElementById('entityControlBar');
      const toleranceBar = document.getElementById('entityToleranceBar');
      if(controlBar) controlBar.style.width = dataModel.kiEspiritual.entidad.controlMental + '%';
      if(toleranceBar) toleranceBar.style.width = dataModel.kiEspiritual.entidad.toleranciaKiDimensional + '%';
    }
  }
} else {
  if(hasSpirit && !hasVoid){
    const spiritType = getSpiritType(dataModel.kiEspiritual.tipo);
    const spiritWarning = getSpiritWarning(dataModel.kiEspiritual.tipo);
    
    let spiritHTML = '<strong>üëª Ki Espiritual</strong>';
    spiritHTML += '<div class="spirit-type">Tipo: ' + spiritType.name + '</div>';
    
    // ESP√çRITU NORMAL o ANEXI√ìN
    if(dataModel.kiEspiritual.tipo !== "entidad"){
      if(dataModel.kiEspiritual.objetivo.active){
        spiritHTML += '<div class="spirit-target-info">';
        spiritHTML += '<strong>üìç Objetivo Actual:</strong> ' + dataModel.kiEspiritual.objetivo.nombre + '<br>';
        
        if(dataModel.kiEspiritual.tipo === "normal"){
          spiritHTML += '<em>Copiando energ√≠a exacta del objetivo</em>';
        } else {
          spiritHTML += '<em>Superando al objetivo en +' + dataModel.kiEspiritual.anexion.boostPercentage + '%</em>';
        }
        
        spiritHTML += '</div>';
      } else {
        spiritHTML += '<div class="spirit-no-target">‚ö†Ô∏è Sin objetivo activo. Stats f√≠sicos indeterminados.</div>';
      }
    }
    
    // LA ENTIDAD
    if(dataModel.kiEspiritual.tipo === "entidad"){
      spiritHTML += '<div class="entity-abilities">';
      spiritHTML += '<div class="entity-ability-item"><strong>üåë Naturaleza:</strong> Ser incompleto sin vida ni alma</div>';
      
      spiritHTML += '<div class="entity-ability-item"><strong>üß† Control Mental:</strong> ' + dataModel.kiEspiritual.entidad.controlMental + '%</div>';
      spiritHTML += '<div class="entity-control-bar-container"><div class="entity-control-bar" id="entityControlBar"></div></div>';
      
      spiritHTML += '<div class="entity-ability-item"><strong>üíé Cristales:</strong> ' + (dataModel.kiEspiritual.entidad.cristalesActivos ? 'Activos' : 'Inactivos') + '</div>';
      
      spiritHTML += '<div class="entity-ability-item"><strong>‚ö° Tolerancia Ki Dimensional:</strong> ' + dataModel.kiEspiritual.entidad.toleranciaKiDimensional + '%</div>';
      spiritHTML += '<div class="entity-control-bar-container"><div class="entity-control-bar" id="entityToleranceBar"></div></div>';
      
      spiritHTML += '<div class="entity-ability-item" style="margin-top:8px;"><strong>Habilidades:</strong> Regeneraci√≥n, Clonaci√≥n, Creaci√≥n de Armas, Distorsi√≥n Espacial</div>';
      spiritHTML += '</div>';
    }
    
    // Advertencia
    spiritHTML += '<div class="spirit-warning"><strong>' + (dataModel.kiEspiritual.tipo === "entidad" ? 'üåë' : '‚ö†Ô∏è') + '</strong> ' + spiritWarning + '</div>';
    
    spiritBox.innerHTML = spiritHTML;
    spiritBox.classList.add('show');
    
    // Aplicar clase seg√∫n tipo
    if(dataModel.kiEspiritual.tipo === "anexion"){
      spiritBox.classList.add('anexion');
    } else if(dataModel.kiEspiritual.tipo === "entidad"){
      spiritBox.classList.add('entidad');
    }
    
    // Animar barras de La Entidad
    if(dataModel.kiEspiritual.tipo === "entidad"){
      setTimeout(() => {
        const controlBar = document.getElementById('entityControlBar');
        const toleranceBar = document.getElementById('entityToleranceBar');
        if(controlBar) controlBar.style.width = dataModel.kiEspiritual.entidad.controlMental + '%';
        if(toleranceBar) toleranceBar.style.width = dataModel.kiEspiritual.entidad.toleranciaKiDimensional + '%';
      }, 100);
    }
  } else {
    spiritBox.classList.remove('show');
  }
}

// Display de Ki Puro
const pureBox = document.getElementById('pureDisplay');

if(pureBox.classList.contains('show')){
  // Solo actualizar si ya est√° mostrado
  if(hasPure && !hasVoid && !hasSpirit){
    if(dataModel.kiPuro.tipo === "normal"){
      const purityBar = document.getElementById('pureKiPurityBar');
      if(purityBar) purityBar.style.width = dataModel.kiPuro.pureza + '%';
    } else if(dataModel.kiPuro.tipo === "maligno"){
      const corruptionBar = document.getElementById('pureKiCorruptionBar');
      if(corruptionBar) corruptionBar.style.width = dataModel.kiPuro.corrupcion + '%';
    }
  }
} else {
  if(hasPure && !hasVoid && !hasSpirit){
    const pureType = getPureKiType(dataModel.kiPuro.tipo, dataModel.kiPuro.rango);
    const pureWarning = getPureKiWarning(dataModel.kiPuro.tipo, dataModel.kiPuro.pureza, dataModel.kiPuro.corrupcion);
    const pureBoostValue = calculatePureKiBoost(dataModel.kiPuro);
    
    let pureHTML = '<strong>‚ú® Ki Puro („É•, Yu)</strong>';
    pureHTML += '<div class="pure-type">Tipo: ' + pureType.name + '</div>';
    
    pureHTML += '<div class="pure-rank-info">';
    pureHTML += '<strong>üåü Apariencia:</strong> ' + pureType.brightness + '<br>';
    pureHTML += '<strong>‚ö° Boost de Poder:</strong> +' + Math.round(pureBoostValue) + '%<br>';
    
    // Ki Puro Normal: mostrar pureza
    if(dataModel.kiPuro.tipo === "normal"){
      pureHTML += '<strong>üíé Pureza del Coraz√≥n:</strong> ' + dataModel.kiPuro.pureza + '%';
      pureHTML += '<div class="pure-purity-bar-container"><div class="pure-purity-bar" id="pureKiPurityBar"></div></div>';
      
      if(dataModel.kiPuro.pureza < 60){
        pureHTML += '<div style="color:rgba(255,200,100,0.95); font-size:11px; margin-top:6px;">‚ö†Ô∏è Pureza insuficiente. El Ki puede ser inestable.</div>';
      }
    }
    
    // Ki Puro del Purgatorio
    if(dataModel.kiPuro.tipo === "purgatorio"){
      pureHTML += '<strong>üòä Origen:</strong> Nacido de la Felicidad';
    }
    
    // Ki Puro Maligno
    if(dataModel.kiPuro.tipo === "maligno"){
      pureHTML += '<strong>üåë Corrupci√≥n:</strong> ' + dataModel.kiPuro.corrupcion + '%';
      pureHTML += '<div class="pure-corruption-bar-container"><div class="pure-corruption-bar" id="pureKiCorruptionBar"></div></div>';
      pureHTML += '<div style="color:rgba(255,150,150,0.95); font-size:11px; margin-top:6px;">Regalo de La Presentadora ‚Ä¢ Err√°tico e Inestable</div>';
    }
    
    pureHTML += '</div>';
    
    // Advertencia/Informaci√≥n
    let warningClass = 'pure-warning';
    if(dataModel.kiPuro.tipo === "maligno"){
      warningClass += ' corrupted';
    } else if(dataModel.kiPuro.tipo === "normal" && dataModel.kiPuro.pureza < 60){
      warningClass += ' requirement';
    }
    
    pureHTML += '<div class="' + warningClass + '"><strong>' + (dataModel.kiPuro.tipo === "maligno" ? 'üåë' : '‚ú®') + '</strong> ' + pureWarning + '</div>';
    
    pureBox.innerHTML = pureHTML;
    pureBox.classList.add('show');
    
    // Aplicar clase seg√∫n tipo
    if(dataModel.kiPuro.tipo === "normal"){
      pureBox.classList.add('normal');
    } else if(dataModel.kiPuro.tipo === "purgatorio"){
      pureBox.classList.add('purgatorio');
    } else if(dataModel.kiPuro.tipo === "maligno"){
      pureBox.classList.add('maligno');
    }
    
    // Animar barras
    setTimeout(() => {
      if(dataModel.kiPuro.tipo === "normal"){
        const purityBar = document.getElementById('pureKiPurityBar');
        if(purityBar) purityBar.style.width = dataModel.kiPuro.pureza + '%';
      } else if(dataModel.kiPuro.tipo === "maligno"){
        const corruptionBar = document.getElementById('pureKiCorruptionBar');
        if(corruptionBar) corruptionBar.style.width = dataModel.kiPuro.corrupcion + '%';
      }
    }, 100);
  } else {
    pureBox.classList.remove('show');
  }
}

  updateChart(hasVoid, kiBoost, demonBoost, purgBoost, voidBoost, pureBoost);
  updateParticles(globalRank.cls, hasVoid);
}

function updateChart(hasVoid, kiBoost, demonBoost, purgBoost, voidBoost, pureBoost){
  const ctx = document.getElementById('statsChart').getContext('2d');
  const hasSpirit = dataModel.kiEspiritual && dataModel.kiEspiritual.active;
  const hasUnknownStats = hasSpirit && (!dataModel.kiEspiritual.objetivo.active || dataModel.kiEspiritual.tipo === "entidad");
  const datasets = [];

  if(hasVoid){
    // L√≠nea negra: Ki devorado (lo que tendr√≠a sin el vac√≠o)
    const devouredValues = dataModel.stats.map((s) => {
      let val = s[1];
      const name = s[0];
      
      if(name === "Inteligencia" && demonBoost > 0){
        val = applyDemonDebuff(val, dataModel.kiDemonio);
      }
      
      if(kiBoost > 0 && name !== "Inteligencia"){
        val = applyKiBoost(val, kiBoost, name);
      }
      
      if(demonBoost > 0){
        val = applyDemonBoost(val, demonBoost, name);
      }
      
      if(purgBoost > 0){
        val = applyPurgatoryBoost(val, purgBoost, name);
      }
      
      return val;
    });

    datasets.push({
      label: 'Ki Devorado',
      data: devouredValues,
      backgroundColor: 'rgba(0,0,0,0.4)',
      borderColor: 'rgba(40,40,40,0.9)',
      borderWidth: 3,
      pointBackgroundColor: 'rgba(60,60,60,1)',
      pointBorderColor: 'rgba(0,0,0,1)',
      pointBorderWidth: 2,
      pointHoverRadius: 7,
      tension: 0.28,
      borderDash: [8, 4]
    });

    // L√≠nea del Vac√≠o
    const gVoid = ctx.createLinearGradient(0, 0, 380, 380);
    gVoid.addColorStop(0, 'rgba(255,140,0,0.35)');
    gVoid.addColorStop(0.5, 'rgba(50,50,50,0.4)');
    gVoid.addColorStop(1, 'rgba(20,20,20,0.5)');

    const voidValues = dataModel.stats.map(s => applyVoidBoost(s[1], voidBoost, s[0]));
    
    datasets.push({
      label: 'Ki de Vac√≠o',
      data: voidValues,
      backgroundColor: gVoid,
      borderColor: 'rgba(255,140,0,0.9)',
      borderWidth: 3,
      pointBackgroundColor: 'rgba(255,100,0,1)',
      pointBorderColor: 'rgba(20,20,20,1)',
      pointBorderWidth: 2,
      pointHoverRadius: 8,
      tension: 0.28
    });
  } else {
    // Modo normal: todos los Ki activos
    const g = ctx.createLinearGradient(0, 0, 380, 380);
    g.addColorStop(0, 'rgba(255,0,255,0.28)');
    g.addColorStop(1, 'rgba(0,255,255,0.18)');

    // Manejar stats con ??
    const chartValues = dataModel.stats.map(s => {
      const val = s[1];
      return val === "??" ? 50 : val; // ?? se muestra como 50 en el gr√°fico (valor intermedio)
    });

    datasets.push({
      label: 'Base',
      data: chartValues,
      backgroundColor: g,
      borderColor: hasUnknownStats ? 'rgba(150,150,150,0.5)' : 'rgba(0,255,255,0.92)',
      borderWidth: 2.6,
      borderDash: hasUnknownStats ? [8, 4] : [],
      pointBackgroundColor: hasUnknownStats ? 'rgba(150,150,150,0.8)' : 'rgba(255,0,255,1)',
      pointBorderColor: '#fff',
      pointHoverRadius: 7,
      tension: 0.28
    });

    if(kiBoost > 0){
      const g2 = ctx.createLinearGradient(0, 0, 380, 380);
      g2.addColorStop(0, 'rgba(255,255,0,0.25)');
      g2.addColorStop(1, 'rgba(255,200,0,0.15)');

      const chartBoostedValues = dataModel.stats.map((s) => {
        if(s[0] === "Inteligencia") return s[1];
        return applyKiBoost(s[1], kiBoost, s[0]);
      });

      datasets.push({
        label: 'Ki Dimensional',
        data: chartBoostedValues,
        backgroundColor: g2,
        borderColor: 'rgba(255,255,0,0.88)',
        borderWidth: 2.6,
        pointBackgroundColor: 'rgba(255,255,100,1)',
        pointBorderColor: '#ffff00',
        pointHoverRadius: 7,
        tension: 0.28,
        borderDash: [5, 5]
      });
    }

    if(demonBoost > 0){
      const g3 = ctx.createLinearGradient(0, 0, 380, 380);
      g3.addColorStop(0, 'rgba(220,20,60,0.3)');
      g3.addColorStop(1, 'rgba(255,100,100,0.2)');

      const chartDemonValues = dataModel.stats.map((s) => {
        let val = s[1];
        if(s[0] === "Inteligencia"){
          return applyDemonDebuff(val, dataModel.kiDemonio);
        }
        if(kiBoost > 0){
          val = applyKiBoost(val, kiBoost, s[0]);
        }
        return applyDemonBoost(val, demonBoost, s[0]);
      });

      datasets.push({
        label: 'Ki de Demonio',
        data: chartDemonValues,
        backgroundColor: g3,
        borderColor: 'rgba(220,20,60,0.88)',
        borderWidth: 2.6,
        pointBackgroundColor: 'rgba(255,100,100,1)',
        pointBorderColor: '#ff6464',
        pointHoverRadius: 7,
        tension: 0.28,
        borderDash: [3, 3]
      });
    }

    if(purgBoost > 0){
      const g4 = ctx.createLinearGradient(0, 0, 380, 380);
      g4.addColorStop(0, 'rgba(80,130,255,0.28)');
      g4.addColorStop(1, 'rgba(120,180,255,0.18)');

      const chartPurgValues = dataModel.stats.map((s) => {
        let val = s[1];
        if(s[0] === "Inteligencia"){
          if(demonBoost > 0){
            val = applyDemonDebuff(val, dataModel.kiDemonio);
          }
          return applyPurgatoryBoost(val, purgBoost, "Inteligencia");
        }
        if(kiBoost > 0){
          val = applyKiBoost(val, kiBoost, s[0]);
        }
        if(demonBoost > 0){
          val = applyDemonBoost(val, demonBoost, s[0]);
        }
        return applyPurgatoryBoost(val, purgBoost, s[0]);
      });

      datasets.push({
        label: 'Ki del Purgatorio',
        data: chartPurgValues,
        backgroundColor: g4,
        borderColor: 'rgba(80,130,255,0.92)',
        borderWidth: 2.6,
        pointBackgroundColor: 'rgba(120,180,255,1)',
        pointBorderColor: '#cfe6ff',
        pointHoverRadius: 7,
        tension: 0.28,
        borderDash: [4, 4]
      });
    }

    if(pureBoost > 0){
        console.log("ENTRANDO AL BLOQUE DE KI PURO EN CHART - pureBoost:", pureBoost);
      const g5 = ctx.createLinearGradient(0, 0, 380, 380);
      
      if(dataModel.kiPuro.tipo === "maligno"){
        g5.addColorStop(0, 'rgba(255,0,0,0.3)');
        g5.addColorStop(0.5, 'rgba(255,255,255,0.25)');
        g5.addColorStop(1, 'rgba(139,0,0,0.2)');
      } else if(dataModel.kiPuro.tipo === "purgatorio"){
        g5.addColorStop(0, 'rgba(150,200,255,0.28)');
        g5.addColorStop(1, 'rgba(200,230,255,0.18)');
      } else {
        g5.addColorStop(0, 'rgba(255,240,180,0.28)');
        g5.addColorStop(1, 'rgba(255,255,255,0.18)');
      }

      const chartPureValues = dataModel.stats.map((s) => {
        let val = s[1];
        if(s[0] === "Inteligencia"){
          const pureEffect = getPureCognitiveEffect(dataModel.kiPuro, val);
          if(pureEffect.loss){
            val -= pureEffect.loss;
          } else if(pureEffect.gain){
            val += pureEffect.gain;
          }
          return val;
        }
        if(kiBoost > 0){
          val = applyKiBoost(val, kiBoost, s[0]);
        }
        if(demonBoost > 0){
          val = applyDemonBoost(val, demonBoost, s[0]);
        }
        if(purgBoost > 0){
          val = applyPurgatoryBoost(val, purgBoost, s[0]);
        }
        return applyPureKiBoost(val, pureBoost, s[0], dataModel.kiPuro);
      });

      const pureLabel = dataModel.kiPuro.tipo === "maligno" ? "Ki Puro Maligno" : 
                        dataModel.kiPuro.tipo === "purgatorio" ? "Ki Puro del Purgatorio" : 
                        "Ki Puro";
      const pureColor = dataModel.kiPuro.tipo === "maligno" ? 'rgba(255,0,0,0.88)' :
                        dataModel.kiPuro.tipo === "purgatorio" ? 'rgba(150,200,255,0.92)' :
                        'rgba(255,240,180,0.92)';
      const purePointColor = dataModel.kiPuro.tipo === "maligno" ? 'rgba(255,100,100,1)' :
                             dataModel.kiPuro.tipo === "purgatorio" ? 'rgba(180,220,255,1)' :
                             'rgba(255,255,255,1)';

      datasets.push({
        label: pureLabel,
        data: chartPureValues,
        backgroundColor: g5,
        borderColor: pureColor,
        borderWidth: 2.6,
        pointBackgroundColor: purePointColor,
        pointBorderColor: '#fff',
        pointHoverRadius: 7,
        tension: 0.28,
        borderDash: [6, 3]
      });
    }
  }

  if(chartInstance){
    chartInstance.destroy();
  }

  chartInstance = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: dataModel.stats.map(s => s[0]),
      datasets: datasets
    },
    options: {
      responsive: false,
      maintainAspectRatio: true,
      elements: { line: { tension: 0.28 } },
      scales: {
        r: {
          angleLines: { color: hasVoid ? 'rgba(255,140,0,0.15)' : 'rgba(0,255,255,0.14)' },
          grid: { color: hasVoid ? 'rgba(50,50,50,0.1)' : 'rgba(255,0,255,0.06)', circular: true },
          suggestedMin: 0,
          suggestedMax: 100,
          pointLabels: { color: hasVoid ? 'rgba(255,180,100,0.9)' : 'rgba(0,255,255,0.9)', font: { size: 12 } },
          ticks: { display: false }
        }
      },
      plugins: {
        legend: { display: true, labels: { color: 'rgba(200,220,255,0.8)', font: { size: 11 } } },
        tooltip: { callbacks: { label: function(ctx){ return ctx.dataset.label + ': ' + ctx.formattedValue; } } }
      },
      animation: { duration: 700, easing: 'easeOutQuart' }
    }
  });
}

function updateParticles(rankClass, hasVoid){
  const radarWrapper = document.getElementById('radarWrapper');
  const existingParticles = radarWrapper.querySelectorAll('div:not(canvas)');
  existingParticles.forEach(p => p.remove());

  function createParticleRing(count, opts){
    for(let i = 0; i < count; i++){
      const p = document.createElement('div');
      p.style.position = 'absolute';
      p.style.left = '50%'; 
      p.style.top = '50%';
      p.style.width = opts.size + 'px'; 
      p.style.height = opts.size + 'px';
      p.style.borderRadius = '50%';
      p.style.background = opts.color;
      p.style.opacity = 0.95;
      p.style.zIndex = 4;
      p.style.pointerEvents = 'none';
      radarWrapper.appendChild(p);

      const angle = (i / count) * Math.PI * 2;
      const r = opts.radius;
      const x = Math.cos(angle) * r;
      const y = Math.sin(angle) * r;

      p.animate([
        { transform: 'translate(-50%,-50%) translate('+x+'px, '+y+'px) scale(0.6)', opacity: 0.05 },
        { transform: 'translate(-50%,-50%) translate('+(x*0.6)+'px, '+(y*0.6)+'px) scale(1)', opacity: 0.95 },
        { transform: 'translate(-50%,-50%) translate('+x+'px, '+y+'px) scale(0.6)', opacity: 0.05 }
      ], { duration: opts.duration + Math.random()*600, iterations: Infinity });
    }
  }

  function createShimmer(){
    const ring = document.createElement('div');
    ring.className = 'z-ring';
    ring.style.background = 'conic-gradient(from 90deg, rgba(255,0,255,0.12), rgba(0,255,255,0.08), rgba(255,255,255,0.06), rgba(255,0,255,0.12))';
    ring.animate([{ transform:'translate(-50%,-50%) rotate(0deg)' }, { transform:'translate(-50%,-50%) rotate(360deg)' }], { duration:7000, iterations:Infinity });
    radarWrapper.appendChild(ring);
  }

  if(hasVoid && dataModel.kiVacio.carga > 60){
    createParticleRing(16, {color:'rgba(255,100,0,0.6)', radius:130, size:3, duration:2800});
    createParticleRing(10, {color:'rgba(50,50,50,0.7)', radius:100, size:4, duration:3200});
  }

  if(rankClass === 'SS'){
    createParticleRing(12, {color:'#ff7bff', radius:120, size:3.5, duration:3000});
  }
  if(rankClass === 'Z'){
    createParticleRing(18, {color:'#ff00ff', radius:140, size:4, duration:2200});
    createParticleRing(12, {color:'#00ffff', radius:110, size:2.8, duration:2600});
    createShimmer();
  }
  if(rankClass === 'S'){
    createParticleRing(10, {color:'#00d4ff', radius:120, size:2.6, duration:3600});
  }
}

document.addEventListener('DOMContentLoaded', ()=>{
  const gridContainer = document.createElement('div');
  gridContainer.className = 'grid-container';
  const gridLines = document.createElement('div');
  gridLines.className = 'grid-lines';
  gridContainer.appendChild(gridLines);
  document.body.insertBefore(gridContainer, document.body.firstChild);

  const rainContainer = document.createElement('div');
  rainContainer.className = 'rain';
  document.body.insertBefore(rainContainer, document.body.firstChild.nextSibling);

  for(let i = 0; i < 100; i++){
    const drop = document.createElement('div');
    drop.className = 'raindrop';
    drop.style.left = Math.random() * 100 + '%';
    drop.style.top = Math.random() * -100 + 'vh';
    drop.style.animationDuration = (Math.random() * 0.5 + 0.8) + 's';
    drop.style.animationDelay = Math.random() * 2 + 's';
    drop.style.opacity = Math.random() * 0.5 + 0.3;
    rainContainer.appendChild(drop);
  }

  document.getElementById('nameText').textContent = dataModel.name;
  document.getElementById('logoImg').src = dataModel.logoPath;

  if(dataModel.kiVacio && dataModel.kiVacio.active){
    startVoidDrain();
  }

  updateDisplay();
});
</script>

</body>

</html>
